<!DOCTYPE html>
<html lang="ko">

<head>
  <!-- Google tag (gtag.js) - 호스트별 자동 선택 -->
  <script>
    (function() {
      const GA_IDS = {
        'etloveaui.github.io': 'G-X7MZFQZRBW',
        '100xfenok.pages.dev': 'G-BWHGXQPH2D'
      };
      const id = GA_IDS[location.hostname] || 'G-X7MZFQZRBW';
      const s = document.createElement('script');
      s.async = true;
      s.src = 'https://www.googletagmanager.com/gtag/js?id=' + id;
      document.head.appendChild(s);
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      window.gtag = gtag;
      gtag('js', new Date());
      gtag('config', id);
    })();
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FenoK Dashboard</title>
  <meta name="description" content="FenoK investment analytics and trading tools">
  <meta property="og:title" content="FenoK Dashboard">
  <meta property="og:image" content="./favicon-96x96.png">
  <meta name="theme-color" content="#0ea5e9">
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <link rel="icon" type="image/svg+xml" href="./favicon.svg">
  <link rel="icon" type="image/png" sizes="96x96" href="./favicon-96x96.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
  <link rel="manifest" href="./site.webmanifest">
  <meta name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Noto+Sans+KR:wght@500;700&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="nav.css">
  <script type="module" src="initBaseHref.js"></script>
  <!--
    OneSignal Push Notification (비활성화)
    - 정적 사이트에서 사용 불가
    - 추후 서버 환경 구축 시 활성화 예정

  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
  <script>
    window.OneSignal = window.OneSignal || [];
    OneSignal.push(function () {
      OneSignal.init({
        appId: "cae7e21e-b682-4d41-a04-6137973552c0",
        serviceWorkerPath: "/100xFenok/OneSignalSDKWorker.js",
        serviceWorkerParam: { scope: '/100xFenok/' }
      });
    });
  </script>
  -->


  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    .frame-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    #nav {
      flex-shrink: 0;
    }

    #content-frame {
      flex-grow: 1;
      border: none;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .animate-fadeIn {
      animation: fadeIn 0.5s ease-in-out;
    }

    /* ========================================
   푸터 공유 버튼 스타일
   ======================================== */

    .footer-share-btn[data-tooltip] {
      position: relative;
    }

    .footer-share-btn[data-tooltip]::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 120%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 400;
      white-space: nowrap;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      display: block;
    }

    .footer-share-btn[data-tooltip]:hover::after {
      opacity: 1;
    }

    /* ========================================
       Footer v21 - Broadcast HUD Pro
       ======================================== */

    /* Ticker scroll - Full traverse (right edge → left edge) */
    .ticker-track {
      width: 100%;
      overflow: hidden;
      position: relative;
    }
    .ticker-scroll {
      display: inline-block;
      white-space: nowrap;
      padding-left: 100%;
      animation: ticker-traverse 18s linear infinite;
      /* GPU acceleration for smooth animation */
      will-change: transform;
      transform: translateZ(0);
      backface-visibility: hidden;
    }
    .ticker-scroll:hover {
      animation-play-state: paused;
    }
    @keyframes ticker-traverse {
      0% { transform: translate3d(0, 0, 0); }
      100% { transform: translate3d(-100%, 0, 0); }
    }

    /* Glow effect */
    .glow-bar {
      box-shadow: 0 0 15px rgba(1, 0, 121, 0.25);
    }

    /* Market status colors */
    .market-regular { background: linear-gradient(135deg, #10b981, #059669); }
    .market-pre { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .market-after { background: linear-gradient(135deg, #f97316, #ea580c); }
    .market-overnight { background: linear-gradient(135deg, #3b82f6, #2563eb); }
    .market-closed { background: linear-gradient(135deg, #6b7280, #4b5563); }

    /* Brand colors */
    .text-brand-navy { color: #010079; }
    .text-brand-gold { color: #D5AD36; }
    .text-brand-interactive { color: #1B73D3; }
    .bg-brand-navy { background-color: #010079; }
    .from-brand-navy { --tw-gradient-from: #010079; }
    .via-brand-interactive { --tw-gradient-via: #1B73D3; }
    .to-brand-navy { --tw-gradient-to: #010079; }
    .to-brand-interactive { --tw-gradient-to: #1B73D3; }
    .ring-brand-interactive { --tw-ring-color: #1B73D3; }
    .hover\:bg-brand-navy:hover { background-color: #010079; }

    /* Admin modal */
    .modal-backdrop {
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
  </style>

</head>

<body class="animate-fadeIn text-base sm:text-lg lg:text-xl">
  <div class="frame-container">
    <div id="nav"></div>
    <iframe id="content-frame" name="content-display-area" class="w-full" loading="lazy"></iframe>

    <!-- Admin Password Modal -->
    <div id="admin-modal" class="fixed inset-0 modal-backdrop hidden z-50 flex items-center justify-center">
      <div class="bg-white rounded-2xl shadow-2xl p-6 w-80 max-w-[90vw]">
        <h3 class="text-lg font-bold text-brand-navy mb-4 flex items-center gap-2">
          <i class="fas fa-lock text-brand-interactive"></i>
          Access Control
        </h3>
        <input
          type="password"
          id="admin-password"
          class="w-full px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-interactive mb-4"
          placeholder="Password"
          autocomplete="off"
        >
        <div class="flex gap-2">
          <button
            id="admin-cancel-btn"
            class="flex-1 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg font-medium transition-colors"
          >
            Cancel
          </button>
          <button
            id="admin-submit-btn"
            class="flex-1 px-4 py-2 bg-brand-interactive hover:bg-brand-navy text-white rounded-lg font-medium transition-colors"
          >
            Confirm
          </button>
        </div>
      </div>
    </div>

    <!-- Footer v21: Broadcast HUD Pro -->
    <footer class="fixed bottom-0 left-0 right-0 z-40">
      <!-- Upper Ticker Bar - Desktop Only -->
      <div class="hidden md:block glow-bar overflow-hidden" style="background: linear-gradient(to right, #010079, #1B73D3, #010079);">
        <div class="h-6 flex items-center px-4">
          <!-- Left: LIVE Badge -->
          <div class="flex items-center gap-1.5 flex-shrink-0 mr-3">
            <span class="w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse"></span>
            <span class="text-[9px] font-bold text-white uppercase">LIVE</span>
          </div>

          <!-- Center: Data Ticker (Full traverse from right to left) -->
          <div class="ticker-track flex-1">
            <div id="ticker-content" class="ticker-scroll cursor-pointer text-[11px] font-medium text-white/90" title="15-minute delayed data">
              <span class="text-white/50">Loading market data...</span>
            </div>
          </div>

          <!-- 15m Delayed Badge -->
          <div class="flex items-center gap-1.5 px-2 py-0.5 rounded bg-amber-500/20 border border-amber-400/30 ml-2 flex-shrink-0">
            <span class="text-[9px] font-bold text-amber-300 uppercase">15m</span>
          </div>

          <!-- Right: Market Status Badge -->
          <button
            id="market-badge"
            class="market-regular px-2.5 py-1 rounded text-white text-[10px] font-bold tracking-wide shadow-sm transition-all duration-200 hover:scale-105 hover:brightness-110 ml-3 flex-shrink-0"
            aria-label="Market Status"
          >
            <span id="market-text">MARKET OPEN</span>
          </button>
        </div>
      </div>

      <!-- Main Bar - Compact -->
      <div class="bg-white/95 backdrop-blur-md border-t border-brand-navy/20 shadow-[0_-6px_20px_rgba(0,0,0,0.08)]">
        <div class="container mx-auto px-4 sm:px-6">
          <div class="h-12 flex items-center justify-between gap-3">

            <!-- Left: Brand (URL copy on click) -->
            <button
              id="footer-share-btn"
              class="flex items-center gap-2 group cursor-pointer min-w-0"
              aria-label="Copy URL"
            >
              <div class="w-11 h-11 rounded-lg bg-gradient-to-br from-brand-navy/10 to-brand-interactive/10 flex items-center justify-center text-brand-navy group-hover:from-brand-navy group-hover:to-brand-interactive group-hover:text-white transition-all duration-300 flex-shrink-0">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="hidden sm:flex flex-col">
                <span class="font-[800] orbitron text-slate-800 text-sm group-hover:text-brand-interactive transition-colors leading-none">
                  100x <span class="text-brand-gold">FENOK</span>
                </span>
                <span class="text-[10px] text-slate-400">© 2026 All rights reserved</span>
              </div>
            </button>

            <!-- Center: Disclaimer / Mobile Market Status -->
            <div class="flex-1 flex justify-center min-w-0">
              <p class="hidden md:block text-[11px] text-slate-600 truncate max-w-[400px]">
                모든 정보는 투자 참고용이지만, <span class="font-bold text-slate-800">손실 나면 니 탓</span> <span class="font-bold text-brand-gold">수익 나면 내 탓</span>
              </p>
              <!-- Mobile: Market Status Badge -->
              <button
                id="market-badge-mobile"
                class="md:hidden market-regular px-3 py-1.5 rounded text-white text-[10px] font-bold tracking-wide shadow-sm"
                aria-label="Market Status"
              >
                <span id="market-text-mobile">MARKET OPEN</span>
              </button>
            </div>

            <!-- Right: Utility Buttons -->
            <div class="flex items-center gap-1.5">
              <button
                id="notification-btn"
                class="w-11 h-11 rounded-lg bg-slate-50 hover:bg-slate-100 border border-slate-200 flex items-center justify-center text-slate-600 hover:text-brand-interactive transition-all duration-200"
                aria-label="Notifications"
              >
                <i class="fas fa-bell text-sm"></i>
              </button>
              <button
                id="admin-trigger"
                class="hidden sm:flex w-11 h-11 rounded-lg bg-slate-50 hover:bg-slate-100 border border-slate-200 items-center justify-center text-slate-600 hover:text-brand-interactive transition-all duration-200"
                aria-label="Admin"
              >
                <i class="fas fa-cog text-sm"></i>
              </button>
              <button
                id="help-btn"
                class="hidden sm:flex w-11 h-11 rounded-lg bg-slate-50 hover:bg-slate-100 border border-slate-200 items-center justify-center text-slate-600 hover:text-brand-interactive transition-all duration-200"
                aria-label="Help"
              >
                <i class="fas fa-question text-sm"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </footer>


  </div>
</body>

</div>
<script type="module">
  const { siteVersion } = await import(`${window.baseHref}version.js`);
  const { loadNav } = await import(`${window.baseHref}loadNav.js`);
  const { loadPage } = await import(`${window.baseHref}loadPage.js`);
  const { showToast } = await import(`${window.baseHref}notification-manager.js`);

  // Inject nav dynamically
  if (window.top === window.self) {
    await loadNav(siteVersion);
  }
  // SPA: nav click → loadPage
  document.addEventListener('click', function (e) {
    const a = e.target.closest('a[data-path]');
    if (a) {
      e.preventDefault();
      loadPage(a.getAttribute('data-path'));
      // 모바일 메뉴 닫기 (nav.html 내 스크립트와 연동 가능)
      const mm = document.getElementById('mobile-menu');
      if (mm && !mm.classList.contains('hidden')) mm.classList.add('hidden');
    }
  });
  // Initial load (deep link)
  const urlParams = new URLSearchParams(window.location.search);
  const initialPath = urlParams.get('path');
  if (window.top === window.self) {
    loadPage(initialPath || 'main.html');
  }

  // ===== Footer v21: URL Share Button =====
  const shareBtn = document.getElementById('footer-share-btn');
  if (shareBtn) {
    shareBtn.addEventListener('click', function (e) {
      e.preventDefault();
      e.stopPropagation();
      const currentPath = window.currentActivePage || 'main.html';
      const baseURL = window.location.origin + window.location.pathname;
      const completeURL = `${baseURL}?path=${currentPath}`;
      navigator.clipboard.writeText(completeURL).then(() => {
        showToast('URL copied!', 'success');
      }).catch(() => {
        showToast('Copy failed', 'error');
      });
    });
  }

  // ===== Footer v21: Admin Authentication =====
  const adminTrigger = document.getElementById('admin-trigger');
  const adminModal = document.getElementById('admin-modal');
  const adminPassword = document.getElementById('admin-password');
  const adminCancelBtn = document.getElementById('admin-cancel-btn');
  const adminSubmitBtn = document.getElementById('admin-submit-btn');

  function openAdminModal() {
    adminModal.classList.remove('hidden');
    adminPassword.value = '';
    adminPassword.focus();
  }

  function closeAdminModal() {
    adminModal.classList.add('hidden');
  }

  async function verifyAdminPassword() {
    const input = adminPassword.value;
    if (!input) return;

    const encoder = new TextEncoder();
    const data = encoder.encode(input);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

    // Password: Rladmsxo1! (낌은태1!)
    const correctHash = '8736ca6f3957409305f60068e93215c85f8751e4dcdc9303832b325a72c7789f';

    if (hashHex === correctHash) {
      sessionStorage.setItem('adminAuth', 'true');
      closeAdminModal();
      window.location.href = `${window.baseHref}admin/index.html`;
    } else {
      adminPassword.value = '';
      adminPassword.classList.add('border-red-500');
      setTimeout(() => adminPassword.classList.remove('border-red-500'), 500);
      showToast('Access denied', 'error');
    }
  }

  if (adminTrigger) {
    adminTrigger.addEventListener('click', openAdminModal);
  }
  if (adminCancelBtn) {
    adminCancelBtn.addEventListener('click', closeAdminModal);
  }
  if (adminSubmitBtn) {
    adminSubmitBtn.addEventListener('click', verifyAdminPassword);
  }
  if (adminPassword) {
    adminPassword.addEventListener('keydown', (e) => { if (e.key === 'Enter') verifyAdminPassword(); });
  }
  if (adminModal) {
    adminModal.addEventListener('click', (e) => { if (e.target === adminModal) closeAdminModal(); });
  }
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeAdminModal(); });

  // ===== Footer v21: Notification Button =====
  const notificationBtn = document.getElementById('notification-btn');
  if (notificationBtn) {
    notificationBtn.addEventListener('click', () => {
      showToast('No new notifications', 'info');
    });
  }

  // ===== Footer v21: Help Button =====
  const helpBtn = document.getElementById('help-btn');
  if (helpBtn) {
    helpBtn.addEventListener('click', () => {
      showToast('100xFenok Market Monitoring Tools', 'info');
    });
  }

  // ===== Footer v21: US Market Status =====
  function isDST(date) {
    const year = date.getFullYear();
    const marchFirst = new Date(year, 2, 1);
    const dstStart = new Date(year, 2, 8 + (7 - marchFirst.getDay()) % 7);
    const novFirst = new Date(year, 10, 1);
    const dstEnd = new Date(year, 10, 1 + (7 - novFirst.getDay()) % 7);
    return date >= dstStart && date < dstEnd;
  }

  function getETTime() {
    const now = new Date();
    const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
    const offset = isDST(now) ? -4 : -5;
    return new Date(utc + (3600000 * offset));
  }

  function getMarketStatus() {
    const et = getETTime();
    const day = et.getDay();
    const hours = et.getHours();
    const minutes = et.getMinutes();
    const time = hours * 100 + minutes;

    if (day === 0 || day === 6) {
      return { status: 'closed', text: 'MARKET CLOSED', class: 'market-closed' };
    }

    if (time >= 400 && time < 930) {
      return { status: 'pre', text: 'MARKET PRE', class: 'market-pre' };
    } else if (time >= 930 && time < 1600) {
      return { status: 'regular', text: 'MARKET OPEN', class: 'market-regular' };
    } else if (time >= 1600 && time < 2000) {
      return { status: 'after', text: 'MARKET AFTER', class: 'market-after' };
    } else {
      return { status: 'overnight', text: 'MARKET NIGHT', class: 'market-overnight' };
    }
  }

  function updateMarketStatus() {
    const market = getMarketStatus();

    // Desktop badge
    const badge = document.getElementById('market-badge');
    const text = document.getElementById('market-text');
    if (badge && text) {
      text.textContent = market.text;
      badge.className = badge.className.replace(/market-\w+/g, '');
      badge.classList.add(market.class);
    }

    // Mobile badge
    const badgeMobile = document.getElementById('market-badge-mobile');
    const textMobile = document.getElementById('market-text-mobile');
    if (badgeMobile && textMobile) {
      textMobile.textContent = market.text;
      badgeMobile.className = badgeMobile.className.replace(/market-\w+/g, '');
      badgeMobile.classList.add(market.class);
    }
  }

  function showMarketInfo() {
    const et = getETTime();
    const market = getMarketStatus();
    const dst = isDST(new Date()) ? 'DST' : 'EST';
    const etTime = et.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
    showToast(`${market.text} | ET ${etTime} (${dst})`, 'info');
  }

  // Market badge click handlers
  const marketBadge = document.getElementById('market-badge');
  const marketBadgeMobile = document.getElementById('market-badge-mobile');
  if (marketBadge) marketBadge.addEventListener('click', showMarketInfo);
  if (marketBadgeMobile) marketBadgeMobile.addEventListener('click', showMarketInfo);

  // Initialize and auto-update market status
  updateMarketStatus();
  setInterval(updateMarketStatus, 60000);

  // ===== Footer v21: Live Ticker API Integration =====
  const TICKER_API = 'https://ticker-api.etloveaui.workers.dev/api/ticker';
  const TICKER_REFRESH = 300000; // 5 minutes

  function formatNumber(num, isCurrency = false) {
    if (isCurrency) return '$' + num.toLocaleString('en-US', { maximumFractionDigits: 0 });
    return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  }

  function formatChange(change, percent) {
    const sign = percent >= 0 ? '+' : '';
    const colorClass = percent >= 0 ? 'text-green-400' : 'text-red-400';
    return `<span class="${colorClass} font-semibold">(${sign}${percent.toFixed(2)}%)</span>`;
  }

  async function updateTicker() {
    const tickerEl = document.getElementById('ticker-content');
    if (!tickerEl) return;

    try {
      const res = await fetch(TICKER_API);
      if (!res.ok) throw new Error('API error');
      const data = await res.json();

      if (data.symbols) {
        const { sp500, nasdaq, btc, vix, fearGreed } = data.symbols;
        tickerEl.innerHTML = `
          <span class="font-bold text-white">S&P 500</span>
          <span class="text-white/70 mx-1">${formatNumber(sp500.price)}</span>
          ${formatChange(sp500.change, sp500.changePercent)}
          <span class="text-white/30 mx-3">•</span>
          <span class="font-bold text-white">NASDAQ</span>
          <span class="text-white/70 mx-1">${formatNumber(nasdaq.price)}</span>
          ${formatChange(nasdaq.change, nasdaq.changePercent)}
          <span class="text-white/30 mx-3">•</span>
          <span class="font-bold text-amber-300">BTC</span>
          <span class="text-white/70 mx-1">${formatNumber(btc.price, true)}</span>
          ${formatChange(btc.change, btc.changePercent)}
          <span class="text-white/30 mx-3">•</span>
          <span class="font-bold text-cyan-300">VIX</span>
          <span class="text-white/70 mx-1">${formatNumber(vix.price)}</span>
          ${formatChange(vix.change, vix.changePercent)}
          <span class="text-white/30 mx-3">•</span>
          <span class="font-bold text-orange-300">Fear & Greed</span>
          <span class="${fearGreed.value >= 55 ? 'text-green-400' : fearGreed.value <= 45 ? 'text-red-400' : 'text-yellow-400'} font-semibold mx-1">${fearGreed.value} (${fearGreed.rating})</span>
        `;
      }
    } catch (e) {
      console.warn('[Ticker] API fetch failed:', e);
      tickerEl.innerHTML = '<span class="text-white/50">Market data temporarily unavailable</span>';
    }
  }

  // Initial fetch and auto-refresh
  updateTicker();
  setInterval(updateTicker, TICKER_REFRESH);

  // ===== 위젯 데이터 전달 (postMessage) - 기본 핸들러 =====
  // DataFetcher module에서 비동기 핸들러가 오버라이드함
  // 하위 호환을 위해 기본 핸들러 유지
  window._widgetDataHandler = function(event) {
    if (event.data && event.data.type === 'REQUEST_WIDGET_DATA') {
      const widgetId = event.data.widgetId;
      console.log(`[Index] ${widgetId} 데이터 요청 수신 (기본 핸들러)`);

      try {
        const rawData = localStorage.getItem(`macro_${widgetId}`);
        if (rawData) {
          const parsed = JSON.parse(rawData);
          event.source.postMessage({
            type: 'WIDGET_DATA_RESPONSE',
            widgetId: widgetId,
            payload: parsed.data
          }, '*');
          console.log(`[Index] ${widgetId} 데이터 응답 전송`);
        } else {
          console.log(`[Index] ${widgetId} localStorage 데이터 없음`);
        }
      } catch (e) {
        console.warn(`[Index] ${widgetId} 데이터 처리 실패:`, e);
      }
    }
  };
  window.addEventListener('message', window._widgetDataHandler);

</script>

<!-- ===== DataFetcher 기반 위젯 데이터 갱신 (2026-01-08 추가) ===== -->
<script type="module">
  import { DataFetcher } from './tools/macro-monitor/shared/data-fetcher.js';

  // 기존 핸들러 제거 후 새 핸들러 등록
  if (window._widgetDataHandler) {
    window.removeEventListener('message', window._widgetDataHandler);
    delete window._widgetDataHandler;
  }

  // DataFetcher를 사용한 비동기 핸들러
  window.addEventListener('message', async (event) => {
    if (event.data && event.data.type === 'REQUEST_WIDGET_DATA') {
      const widgetId = event.data.widgetId;
      console.log(`[Index] ${widgetId} 데이터 요청 수신 (DataFetcher)`);

      try {
        // DataFetcher가 캐시 상태 확인 → stale이면 API 호출
        const result = await DataFetcher.fetch(widgetId);

        if (result.data) {
          event.source.postMessage({
            type: 'WIDGET_DATA_RESPONSE',
            widgetId: widgetId,
            payload: result.data
          }, '*');
          console.log(`[Index] ${widgetId}: ${result.isFresh ? 'fresh' : 'stale'} 데이터 응답`);
        } else {
          console.log(`[Index] ${widgetId} 데이터 없음`);
        }
      } catch (e) {
        console.warn(`[Index] ${widgetId} 데이터 처리 실패:`, e);

        // 폴백: localStorage에서 직접 읽기
        try {
          const rawData = localStorage.getItem(`macro_${widgetId}`);
          if (rawData) {
            const parsed = JSON.parse(rawData);
            event.source.postMessage({
              type: 'WIDGET_DATA_RESPONSE',
              widgetId: widgetId,
              payload: parsed.data
            }, '*');
            console.log(`[Index] ${widgetId} 폴백 응답`);
          }
        } catch (e2) {}
      }
    }
  });

  console.log('[Index] DataFetcher 기반 위젯 데이터 핸들러 활성화');
</script>
<!-- Global Loading Spinner -->
<div id="global-spinner"
  class="fixed inset-0 bg-white/80 backdrop-blur-sm z-[9999] hidden flex items-center justify-center transition-opacity duration-300">
  <div class="text-center">
    <div class="inline-block w-12 h-12 border-4 border-slate-200 border-t-blue-600 rounded-full animate-spin mb-4">
    </div>
    <p class="text-slate-600 font-bold text-sm animate-pulse">LOADING...</p>
  </div>
</div>

</body>

</html>