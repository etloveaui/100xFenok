<!DOCTYPE html>
<html lang="ko">

<head>
  <!-- Google tag (gtag.js) - 호스트별 자동 선택 -->
  <script>
    (function() {
      const GA_IDS = {
        'etloveaui.github.io': 'G-X7MZFQZRBW',
        '100xfenok.pages.dev': 'G-BWHGXQPH2D'
      };
      const id = GA_IDS[location.hostname] || 'G-X7MZFQZRBW';
      const s = document.createElement('script');
      s.async = true;
      s.src = 'https://www.googletagmanager.com/gtag/js?id=' + id;
      document.head.appendChild(s);
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      window.gtag = gtag;
      gtag('js', new Date());
      gtag('config', id);
    })();
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FenoK Dashboard</title>
  <meta name="description" content="FenoK investment analytics and trading tools">
  <meta property="og:title" content="FenoK Dashboard">
  <meta property="og:image" content="./favicon-96x96.png">
  <meta name="theme-color" content="#0ea5e9">
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <link rel="icon" type="image/svg+xml" href="./favicon.svg">
  <link rel="icon" type="image/png" sizes="96x96" href="./favicon-96x96.png">
  <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
  <link rel="manifest" href="./site.webmanifest">
  <meta name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Noto+Sans+KR:wght@500;700&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="nav.css">
  <script type="module" src="initBaseHref.js"></script>
  <!--
    OneSignal Push Notification (비활성화)
    - 정적 사이트에서 사용 불가
    - 추후 서버 환경 구축 시 활성화 예정

  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
  <script>
    window.OneSignal = window.OneSignal || [];
    OneSignal.push(function () {
      OneSignal.init({
        appId: "cae7e21e-b682-4d41-a04-6137973552c0",
        serviceWorkerPath: "/100xFenok/OneSignalSDKWorker.js",
        serviceWorkerParam: { scope: '/100xFenok/' }
      });
    });
  </script>
  -->


  <style>
    body,
    html {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    .frame-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    #nav {
      flex-shrink: 0;
    }

    #content-frame {
      flex-grow: 1;
      border: none;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .animate-fadeIn {
      animation: fadeIn 0.5s ease-in-out;
    }

    /* ========================================
   푸터 공유 버튼 스타일
   ======================================== */

    .footer-share-btn[data-tooltip] {
      position: relative;
    }

    .footer-share-btn[data-tooltip]::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 120%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 400;
      white-space: nowrap;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      display: block;
    }

    .footer-share-btn[data-tooltip]:hover::after {
      opacity: 1;
    }
  </style>

</head>

<body class="animate-fadeIn text-base sm:text-lg lg:text-xl">
  <div class="frame-container">
    <div id="nav"></div>
    <iframe id="content-frame" name="content-display-area" class="w-full" loading="lazy"></iframe>

    <!-- <footer class="enhanced-simple-footer">
      <div class="container mx-auto flex justify-between items-center text-sm text-gray-600">
        <div class="font-medium">
          <span class="orbitron text-gray-800">100x FenoK</span>
          <span class="text-gray-400 ml-2">© 2025</span>
        </div>
        <div class="hidden sm:block text-gray-500">
          모든 정보는 투자 참고용이지만, 손실 나면 니 탓 수익 나면 내 탓
        </div>
      </div>
    </footer> -->

    <!-- 기존 푸터 수정 -->
    <footer class="enhanced-simple-footer bg-white border-t border-gray-200">
      <div class="container mx-auto flex justify-between items-center text-sm">

        <!-- 왼쪽: 브랜드 (클릭 가능하게 수정) -->
        <div class="brand-section flex items-center space-x-3">
          <div class="brand-icon">
            <i class="fas fa-chart-line text-blue-500"></i>
          </div>
          <div class="brand-text-group">
            <!-- 브랜드명을 클릭 가능한 버튼으로 변경 -->
            <button class="brand-name orbitron footer-share-btn" id="footer-share-btn" data-tooltip="투자의 시작">
              100x FenoK
            </button>
            <span class="copyright">© 2025</span>
          </div>
        </div>

        <!-- 가운데: 상태 표시 (클릭 시 관리자 모드) -->
        <div class="status-indicator hidden md:flex items-center space-x-2 cursor-pointer" id="admin-trigger">
          <div class="status-dot"></div>
          <span class="status-text">alive</span>
        </div>

        <!-- 오른쪽: 메시지 -->
        <div class="footer-message hidden sm:block">
          모든 정보는 투자 참고용이지만, 손실 나면 니 탓 수익 나면 내 탓
        </div>

      </div>
    </footer>


  </div>
</body>

</div>
<script type="module">
  const { siteVersion } = await import(`${window.baseHref}version.js`);
  const { loadNav } = await import(`${window.baseHref}loadNav.js`);
  const { loadPage } = await import(`${window.baseHref}loadPage.js`);
  const { showToast } = await import(`${window.baseHref}notification-manager.js`);

  // Inject nav dynamically
  if (window.top === window.self) {
    await loadNav(siteVersion);
  }
  // SPA: nav click → loadPage
  document.addEventListener('click', function (e) {
    const a = e.target.closest('a[data-path]');
    if (a) {
      e.preventDefault();
      loadPage(a.getAttribute('data-path'));
      // 모바일 메뉴 닫기 (nav.html 내 스크립트와 연동 가능)
      const mm = document.getElementById('mobile-menu');
      if (mm && !mm.classList.contains('hidden')) mm.classList.add('hidden');
    }
  });
  // Initial load (deep link)
  const urlParams = new URLSearchParams(window.location.search);
  const initialPath = urlParams.get('path');
  if (window.top === window.self) {
    loadPage(initialPath || 'main.html');
  }

  // 공유 버튼 기능 (수정된 버전)
  const shareBtn = document.getElementById('footer-share-btn');

  if (shareBtn) {
    shareBtn.addEventListener('click', function (e) {
      e.preventDefault();
      e.stopPropagation();

      // 현재 페이지 경로 가져오기 (loadPage.js에서 설정한 전역 변수 사용)
      const currentPath = window.currentActivePage || 'main.html';

      // 완전한 URL 구성
      const baseURL = window.location.origin + window.location.pathname;
      const completeURL = `${baseURL}?path=${currentPath}`;

      // URL 복사
      navigator.clipboard.writeText(completeURL).then(() => {
        showToast('URL이 복사되었습니다!', 'success');
      }).catch(() => {
        // 복사 실패 시 대체 방법 (구형 브라우저 대응)
        showToast('URL 복사에 실패했습니다', 'error');
      });
    });
  }

  // 관리자 모드 진입 (alive 클릭)
  const adminTrigger = document.getElementById('admin-trigger');
  if (adminTrigger) {
    adminTrigger.addEventListener('click', function() {
      // 모달 생성
      const modal = document.createElement('div');
      modal.id = 'admin-modal';
      modal.innerHTML = `
        <div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[10000] flex items-center justify-center">
          <div class="bg-white rounded-2xl p-8 shadow-2xl max-w-sm w-full mx-4 transform transition-all">
            <div class="text-center mb-6">
              <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-user-shield text-white text-2xl"></i>
              </div>
              <h3 class="text-lg font-bold text-gray-800">Access Control</h3>
              <p class="text-gray-500 text-sm mt-1">관리자 인증이 필요합니다</p>
            </div>
            <input type="password" id="admin-pw-input" placeholder="••••••••"
              class="w-full px-4 py-3 border border-gray-300 rounded-xl text-center text-lg tracking-widest focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              autocomplete="off">
            <div class="flex gap-3 mt-6">
              <button id="admin-cancel" class="flex-1 px-4 py-3 bg-gray-100 text-gray-600 rounded-xl font-medium hover:bg-gray-200 transition-colors">취소</button>
              <button id="admin-submit" class="flex-1 px-4 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-medium hover:opacity-90 transition-opacity">확인</button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);

      const pwInput = document.getElementById('admin-pw-input');
      const cancelBtn = document.getElementById('admin-cancel');
      const submitBtn = document.getElementById('admin-submit');

      pwInput.focus();

      const closeModal = () => modal.remove();

      const verifyPassword = async () => {
        const input = pwInput.value;
        if (!input) return;

        const encoder = new TextEncoder();
        const data = encoder.encode(input);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

        const correctHash = 'a73060afb61efe1b7c817645d00c342df02407f65435a64c88d251d56150ff42';

        if (hashHex === correctHash) {
          sessionStorage.setItem('adminAuth', 'true');
          closeModal();
          window.location.href = `${window.baseHref}admin/index.html`;
        } else {
          pwInput.value = '';
          pwInput.classList.add('border-red-500', 'animate-pulse');
          setTimeout(() => pwInput.classList.remove('border-red-500', 'animate-pulse'), 500);
          showToast('접근 거부', 'error');
        }
      };

      cancelBtn.addEventListener('click', closeModal);
      submitBtn.addEventListener('click', verifyPassword);
      pwInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') verifyPassword(); });
      modal.addEventListener('click', (e) => { if (e.target === modal.firstElementChild) closeModal(); });
    });
  }

  // ===== 위젯 데이터 전달 (postMessage) =====
  // main.html에서 요청 → index.html이 응답하는 방식
  // 새 위젯 추가 시: 아래 switch문에 케이스만 추가
  window.addEventListener('message', (event) => {
    // main.html에서 위젯 데이터 요청
    if (event.data && event.data.type === 'REQUEST_WIDGET_DATA') {
      const widgetId = event.data.widgetId;
      console.log(`[Index] ${widgetId} 데이터 요청 수신`);

      try {
        const rawData = localStorage.getItem(`macro_${widgetId}`);
        if (rawData) {
          const parsed = JSON.parse(rawData);
          // 요청한 iframe에 응답
          event.source.postMessage({
            type: 'WIDGET_DATA_RESPONSE',
            widgetId: widgetId,
            payload: parsed.data
          }, '*');
          console.log(`[Index] ${widgetId} 데이터 응답 전송`);
        } else {
          console.log(`[Index] ${widgetId} localStorage 데이터 없음`);
        }
      } catch (e) {
        console.warn(`[Index] ${widgetId} 데이터 처리 실패:`, e);
      }
    }
  });

</script>
<!-- Global Loading Spinner -->
<div id="global-spinner"
  class="fixed inset-0 bg-white/80 backdrop-blur-sm z-[9999] hidden flex items-center justify-center transition-opacity duration-300">
  <div class="text-center">
    <div class="inline-block w-12 h-12 border-4 border-slate-200 border-t-blue-600 rounded-full animate-spin mb-4">
    </div>
    <p class="text-slate-600 font-bold text-sm animate-pulse">LOADING...</p>
  </div>
</div>

</body>

</html>