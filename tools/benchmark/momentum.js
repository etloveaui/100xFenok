const C={c:3e5,n:5,a:800,y:['2018','19','20','21','22','23','24','25']},G={us:['sp500','ndx','ndxc','r2k'],sec:['it','hc','fin','cd','cs','ind','cs2','ene','uti','re','mat','hb'],dev:['es50','topix','hk','nikkei'],em:['shanghai','sensex','kospi','brazil','vietnam','hscei'],msci:['world','dev','em','china','india','korea'],micro:['semi','banks','hstech','biotech']},N={sp500:'S&P 500',ndx:'Nasdaq 100',ndxc:'Nasdaq Composite',r2k:'Russell 2000',it:'Info Tech',hc:'Healthcare',fin:'Financials',cd:'Consumer Disc',cs:'Comm Services',ind:'Industrials',cs2:'Consumer Staples',ene:'Energy',uti:'Utilities',re:'Real Estate',mat:'Materials',hb:'Homebuilders',es50:'Euro Stoxx 50',topix:'TOPIX',hk:'Hong Kong',nikkei:'Nikkei 225',shanghai:'Shanghai',sensex:'India Sensex',kospi:'KOSPI',brazil:'Bovespa',vietnam:'VN-Index',hscei:'HSCEI',world:'MSCI World',dev:'MSCI Dev',em:'MSCI EM',china:'MSCI China',india:'MSCI India',korea:'MSCI Korea',semi:'SOX',banks:'Regional Banks',hstech:'HS Tech',biotech:'Biotech'},Cc=['#3b82f6','#10b981','#f59e0b','#8b5cf6','#ec4899','#14b8a6','#f97316','#6366f1','#eab308','#f87171'],TI={s:'fa-check',i:'fa-info',w:'fa-exclamation',e:'fa-times'},TC={s:'bg-green',i:'bg-blue',w:'bg-yellow',e:'bg-red'},S={d:null,g:'us',st:{k:'6m',a:!1},cs:new Set(),fs:new Set(),cm:!1,q:''};let ci=null,to=null,sp=null;const $=id=>document.getElementById(id),q$=id=>document.querySelector(id),fp=v=>({v:p=v*100,s:p>0?'+':'',c:p>0?'text-green':p<0?'text-red':'text-gray',t:(p>0?'+':'')+p.toFixed(1)+'%'}),rt=d=>d<6e4?'Î∞©Í∏à Ï†Ñ':d<36e5?Math.floor(d/6e4)+'Î∂Ñ Ï†Ñ':d<864e5?Math.floor(d/36e5)+'ÏãúÍ∞Ñ Ï†Ñ':Math.floor(d/864e5)+'Ïùº Ï†Ñ',toast=(m,t='i')=>{const e=document.createElement('div');e.className='toast-enter '+TC[t]+' text-white px-4 py-3 rounded-xl flex items-center gap-3';e.innerHTML='<i class="fas '+TI[t]+'"></i><span>'+m+'</span>';$('toast-container').appendChild(e);setTimeout(()=>e.remove(),3e3)},err=m=>{q$('main').innerHTML='<div class="text-center py-16"><div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-exclamation-triangle text-4xl text-red-500"></i></div><p class="text-gray-700 text-lg mb-2 font-medium">Îç∞Ïù¥ÌÑ∞ Î∂àÍ∞Ä</p><p class="text-gray-500 text-sm mb-4">'+m+'</p><button onclick="location.reload()" class="px-6 py-2 bg-blue-500 text-white rounded-lg">Îã§Ïãú ÏãúÎèÑ</button></div>'};async function load(){try{const cd=localStorage.getItem('mD'),ct=localStorage.getItem('mT');if(cd&&ct&&Date.now()-ct<C.c){S.d=JSON.parse(cd);toast('Ï∫êÏãú','s')}else{const r=await fetch('../../../data/benchmarks/summaries.json');if(!r.ok)throw new Error('Ïã§Ìå®');S.d=await r.json();localStorage.setItem('mD',JSON.stringify(S.d));localStorage.setItem('mT',Date.now());toast('ÏóÖÎç∞Ïù¥Ìä∏','s')}$('relative-time').textContent=rt(Date.now()-(localStorage.getItem('mT')|0));$('data-freshness').classList.remove('hidden');S.d?.metadata?.generated&&($('last-updated').textContent='ÏóÖÎç∞Ïù¥Ìä∏: '+new Date(S.d.metadata.generated).toLocaleString('ko-KR'));renderAll()}catch(e){err(e.message)}}function refresh(){$('refresh-icon').classList.add('animate-spin');localStorage.removeItem('mD');localStorage.removeItem('mT');setTimeout(()=>location.reload(),500)}function upFav(){const h=G[S.g].some(k=>S.fs.has(k));$('fav-icon').classList.toggle('text-yellow-500',h);$('fav-icon').classList.toggle('text-gray-400',!h)}function aCU(){document.querySelectorAll('.animate-count-up').forEach(e=>{const t=parseFloat(e.dataset.value),s=performance.now();(function f(n){const p=Math.min((n-s)/C.a,1),c=t*(1-Math.pow(1-p,3));e.textContent=(c>=0?'+':'')+c.toFixed(1)+'%';p<1&&requestAnimationFrame(f)})(s)})}function renderAll(){const ig=G[S.g],rk=ig.map(k=>({k,n:N[k]||k,m6:S.d.momentum[k]?.['6m']||0,m1:S.d.momentum[k]?.['1m']||0,ytd:S.d.momentum[k]?.['ytd']||0,f:S.fs.has(k)})).sort((a,b)=>b.m6-a.m6);$('top5-cards').innerHTML=rk.slice(0,5).map((i,n)=>{const v=fp(i.m6);return'<div class="metric-card bg-white dark:bg-gray-800 rounded-xl border-2 '+(n===0?'border-yellow-400':'border-green-200')+' p-4 cursor-pointer hover:shadow-xl" onclick="M.show(\''+i.k+'\')" tabindex="0"><div class="flex items-center justify-between"><div class="flex items-center gap-2"><span class="text-lg '+(n===0?'text-yellow-500':n===1?'text-gray-400':n===2?'text-amber-600':'text-gray-400')+'">'+(n===0?'ü•á':n===1?'ü•à':n===2?'ü•â':'#'+(n+1))+'</span><span class="font-bold">'+i.n+'</span>'+(i.f?'<i class="fas fa-star text-yellow-500 text-xs"></i>':'')+'</div><span class="text-xl font-bold '+v.c+' animate-count-up" data-value="'+v.v+'">'+v.t+'</span></div><div class="flex items-center justify-between mt-2 text-xs text-gray-500"><span>1M: '+fp(i.m1).t+'</span><span>YTD: '+fp(i.ytd).t+'</span></div></div>'}).join('');$('bottom5-cards').innerHTML=rk.slice(-5).reverse().map((i,n)=>{const v=fp(i.m6),r=ig.length-n;return'<div class="metric-card bg-white dark:bg-gray-800 rounded-xl border-2 border-red-200 p-4 cursor-pointer hover:shadow-xl" onclick="M.show(\''+i.k+'\')" tabindex="0"><div class="flex items-center justify-between"><div class="flex items-center gap-2"><span class="text-xs bg-red-100 text-red-600 px-2 py-0.5 rounded font-bold">#'+r+'</span><span class="font-bold">'+i.n+'</span></div><span class="text-xl font-bold '+v.c+' animate-count-up" data-value="'+v.v+'">'+v.t+'</span></div></div>'}).join('');setTimeout(aCU,100);const q=S.q.toLowerCase();let d=ig.filter(k=>(N[k]||k).toLowerCase().includes(q)).map(k=>{const m=S.d.momentum[k]||{},r=S.d.yearly_returns[k]||{};return{k,n:N[k]||k,'1m':m['1m'],'3m':m['3m'],'6m':m['6m'],ytd:m.ytd,'2025':r['2025'],f:S.fs.has(k),ic:S.cs.has(k)}});d.sort((a,b)=>{const av=a[S.st.k]||0,bv=b[S.st.k]||0;return S.st.a?av-bv:bv-av});document.querySelectorAll('th[data-sort]').forEach(th=>{const k=th.dataset.sort,ic=th.querySelector('.sort-icon'),a=k===S.st.k;ic.style.transform=a&&!S.st.a?'rotate(180deg)':'rotate(0deg)';ic.classList.toggle('opacity-100',a);ic.classList.toggle('opacity-50',!a)});$('table-count').textContent=d.length+'Í∞ú';$('momentum-tbody').innerHTML=d.map(i=>{const c1=fp(i['1m']),c3=fp(i['3m']),c6=fp(i['6m']),cy=fp(i.ytd),c25=fp(i['2025']);return'<tr class="table-row border-b cursor-pointer '+(i.ic?'bg-blue-50/50':'')+'" onclick="M.toggleC(\''+i.k+'\')" ondblclick="M.toggleF(\''+i.k+'\')" tabindex="0"><td class="px-4 py-3"><div class="flex items-center gap-2"><span class="font-semibold">'+i.n+'</span>'+(i.f?'<i class="fas fa-star text-yellow-500 text-xs"></i>':'')+(i.ic?'<span class="text-xs bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded">Ï∞®Ìä∏</span>':'')+'</div></td><td class="px-4 py-3 text-right '+c1.c+' font-semibold">'+c1.t+'</td><td class="px-4 py-3 text-right '+c3.c+' font-semibold">'+c3.t+'</td><td class="px-4 py-3 text-right '+c6.c+' font-semibold">'+c6.t+'</td><td class="px-4 py-3 text-right '+cy.c+' font-semibold">'+cy.t+'</td><td class="px-4 py-3 text-right '+c25.c+' font-semibold">'+c25.t+'</td></tr>'}).join('');G[S.g].slice(0,C.n).forEach(k=>S.cs.add(k));const ctx=$('chartCanvas').getContext('2d');if(S.cs.size===0){$('chart-empty').classList.remove('hidden');ci&&(ci.destroy(),ci=null)}else{$('chart-empty').classList.add('hidden');const ds=Array.from(S.cs).map((k,i)=>({label:N[k]||k,data:C.y.map(y=>{const v=S.d.yearly_returns[k]?.[y];return v!==undefined?v*100:null}),borderColor:Cc[i%10],backgroundColor:Cc[i%10]+'15',tension:.4,pointRadius:5,pointHoverRadius:8,borderWidth:2.5,fill:!1}));ci&&ci.destroy();ci=new Chart(ctx,{type:'line',data:{labels:C.y,datasets:ds},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:'index'},plugins:{legend:{position:'top',align:'end',labels:{boxWidth:12,usePointStyle:!0,padding:15,font:{size:12}}},tooltip:{backgroundColor:'rgba(255,255,255,0.98)',borderColor:'#e5e7eb',borderWidth:1,cornerRadius:8,padding:12}},scales:{y:{grid:{color:'rgba(0,0,0,0.05)'},ticks:{callback:v=>v+'%'}},x:{grid:{display:!1}}}}})}}function chartAll(){G[S.g].forEach(k=>S.cs.add(k));renderAll();toast('Ï†ÑÏ≤¥ ÏÑ†ÌÉù','s')}function chartTop5(){const rk=G[S.g].map(k=>({k,v:S.d.momentum[k]?.['6m']||0})).sort((a,b)=>b.v-a.v);S.cs.clear();rk.slice(0,5).forEach(i=>S.cs.add(i.k));renderAll();toast('Top 5','s')}function chartClear(){S.cs.clear();renderAll();toast('Ï¥àÍ∏∞Ìôî','i')}function exportChart(){if(!ci)return;const l=document.createElement('a');l.download='momentum-'+S.g+'-'+Date.now()+'.png';l.href=ci.toBase64Image();l.click();toast('Ï∞®Ìä∏ Ï†ÄÏû•','s')}function exportCSV(){const ig=G[S.g],h=['Index','1M','3M','6M','YTD','2024','2025'],r=ig.map(k=>{const m=S.d.momentum[k]||{},r=S.d.yearly_returns[k]||{};return[N[k]||k,(m['1m']*100).toFixed(2),(m['3m']*100).toFixed(2),(m['6m']*100).toFixed(2),(m.ytd*100).toFixed(2),(r['2024']*100).toFixed(2),(r['2025']*100).toFixed(2)].join(',')}).join('\n');const b=new Blob([h.join(',')+'\n'+r],{type:'text/csv'});const l=document.createElement('a');l.download='momentum-'+S.g+'-'+Date.now()+'.csv';l.href=URL.createObjectURL(b);l.click();toast('CSV Ï†ÄÏû•','s')}function show(k){const m=S.d.momentum[k]||{},r=S.d.yearly_returns[k]||{},n=N[k]||k;$('modal-title').textContent=n;$('modal-subtitle').textContent='Summary';$('modal-content').innerHTML='<div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6">'+['1m','3m','6m','ytd'].map(p=>{const c=fp(m[p]||0);return'<div class="bg-blue-50 dark:bg-blue-900/30 rounded-xl p-4 text-center"><div class="text-xs text-blue-600 uppercase mb-1">'+p+'</div><div class="text-xl font-bold '+c.c+'">'+c.t+'</div></div>'}).join('')+'</div><div class="space-y-2"><h4 class="font-semibold text-gray-700 mb-3">Ïó∞Í∞Ñ ÏàòÏùµÎ•†</h4>'+['2025','24','23','22','21'].map(y=>{const v=r[y];if(v===undefined)return'';const c=fp(v);return'<div class="flex justify-between py-2 border-b"><span class="text-gray-600">20'+y+'</span><span class="font-semibold '+c.c+'">'+c.t+'</span></div>'}).join('')+'</div>';$('detail-modal').classList.remove('hidden');document.body.style.overflow='hidden'}function showPE(){$('modal-title').textContent='P/E Band';$('modal-subtitle').textContent='Strategy';$('modal-content').innerHTML='<div class="space-y-4"><div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-4"><h4 class="font-bold text-green-700 mb-2">Undervalued (+434.7%)</h4><p class="text-sm text-gray-600">Buy when P/E is low.</p></div><div class="bg-red-50 dark:bg-red-900/20 rounded-xl p-4"><h4 class="font-bold text-red-700 mb-2">Overvalued (+48.9%)</h4><p class="text-sm text-gray-600">Avoid when P/E is high.</p></div><div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4"><h4 class="font-bold text-blue-700 mb-2">+385%p Difference</h4></div></div>';$('detail-modal').classList.remove('hidden');document.body.style.overflow='hidden'}function closeM(){$('detail-modal').classList.add('hidden');document.body.style.overflow=''}function showK(){$('shortcuts-modal').classList.remove('hidden')}function closeK(){$('shortcuts-modal').classList.add('hidden')}function toggleCmp(){S.cm=!S.cm;const b=$('compare-banner');S.cm?(b.classList.remove('hidden'),toast('ÎπÑÍµê Î™®Îìú','i')):(b.classList.add('hidden'),S.ci=[])}function toggleD(){const d=document.documentElement.classList.toggle('dark');localStorage.setItem('darkMode',d);toast(d?'Îã§ÌÅ¨':'ÎùºÏù¥Ìä∏','i')}function toggleF(k){S.fs.has(k)?(S.fs.delete(k),toast('Ï¶êÍ≤®Ï∞æÍ∏∞ Ìï¥Ï†ú','i')):(S.fs.add(k),toast('Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä','s'));localStorage.setItem('mF',JSON.stringify([...S.fs]));upFav();renderAll()}function toggleFavV(){S.q='‚òÜ';$('table-search').value='';renderAll();toast('Ï¶êÍ≤®Ï∞æÍ∏∞','i')}function toggleQ(){const m=$('quick-actions'),b=$('quick-actions-backdrop');m.classList.toggle('hidden');b.classList.toggle('hidden')}function closeQ(){$('quick-actions').classList.add('hidden');$('quick-actions-backdrop').classList.add('hidden')}q$('.index-chip').forEach(c=>{c.onclick=e=>{const g=e.target.dataset.group||e.target.closest('.index-chip').dataset.group;if(g===S.g)return;q$('.index-chip').forEach(x=>{x.className='index-chip flex-shrink-0 px-4 py-2.5 text-sm rounded-xl font-medium shadow-md bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200'});const t=e.target.classList.contains('index-chip')?e.target:e.target.closest('.index-chip');t.className='index-chip flex-shrink-0 px-4 py-2.5 text-sm rounded-xl font-medium shadow-md bg-blue-500 text-white';S.g=g;S.cs.clear();renderAll()}});$('table-search').oninput=e=>{clearTimeout(to);to=setTimeout(()=>{S.q=e.target.value;renderAll()},200)};q$('th[data-sort]').forEach(th=>{th.onclick=()=>{const k=th.dataset.sort;if(S.st.k===k)S.st.a=!S.st.a;else{S.st.k=k;S.st.a=!1}renderAll()}});document.onkeydown=e=>{if(e.target.tagName==='INPUT')return;switch(e.key.toLowerCase()){case'r':refresh();break;case'/':e.preventDefault();$('table-search').focus();break;case'd':toggleD();break;case'c':toggleCmp();break;case'?':showK();break;case'escape':closeM();closeK();$('share-modal').classList.add('hidden');closeQ();break}};let sy=0,cy=0;const pr=$('pull-refresh'),mc=$('main-content');mc.ontouchstart=e=>{if(window.scrollY===0)sy=e.touches[0].clientY};mc.ontouchmove=e=>{if(window.scrollY===0&&sy>0){cy=e.touches[0].clientY-sy;if(cy>50)pr.classList.add('active')}};mc.ontouchend=()=>{if(cy>100)refresh();pr.classList.remove('active');sy=0;cy=0};const ha=q$('header .flex.items-center.gap-2');if(ha&&!$('pe-band-btn')){const b=document.createElement('button');b.id='pe-band-btn';b.onclick=showPE;b.className='btn-icon p-2 rounded-lg text-gray-500 hover:text-purple-500 hover:bg-purple-50';b.title='P/E Band';b.innerHTML='<i class="fas fa-chart-bar"></i>';ha.insertBefore(b,ha.firstChild)}const M={show,showPE,closeM,showK,closeK,shareShow:()=>$('share-modal').classList.remove('hidden'),shareClose:()=>$('share-modal').classList.add('hidden'),shareCopy:()=>{navigator.clipboard.writeText(location.origin+location.pathname+'?g='+S.g);toast('ÎßÅÌÅ¨ Î≥µÏÇ¨','s');$('share-modal').classList.add('hidden')},shareTW:()=>window.open('https://twitter.com/intent/tweet?text='+encodeURIComponent('Momentum - '+S.g.toUpperCase()),'_blank'),exportChart,exportCSV,chartAll,chartTop5,chartClear,toggleC:k=>{if(S.cs.has(k)){if(S.cs.size>1){S.cs.delete(k);toast((N[k]||k)+' Ï†úÍ±∞','i')}}else{S.cs.add(k);toast((N[k]||k)+' Ï∂îÍ∞Ä','s')}renderAll()},toggleF,toggleD,toggleCmp,toggleQ,closeQ};const d=localStorage.getItem('darkMode')==='true'||(!localStorage.getItem('darkMode')&&window.matchMedia('(prefers-color-scheme: dark)').matches);if(d)document.documentElement.classList.add('dark');const sf=localStorage.getItem('mF');if(sf)S.fs=new Set(JSON.parse(sf));upFav();load();