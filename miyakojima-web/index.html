<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="미야코지마 여행 스마트 컴패니언 - 실시간 예산 추적, GPS 기반 추천, 스마트 일정 관리">
    <title>🏝️ 미야코지마 여행 컴패니언</title>

    <!-- PWA 설정 -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#00bcd4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="미야코지마 컴패니언">

    <!-- CSS -->
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="./css/mobile.css">

    <!-- 무료 아이콘 (Feather Icons CDN 대체용 인라인 SVG) -->
    <style>
        .icon { width: 20px; height: 20px; fill: none; stroke: currentColor; stroke-width: 2; }
    </style>
</head>
<body>
    <!-- 로딩 스크린 -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loader">🏝️</div>
            <p>미야코지마 데이터 로딩 중...</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>
    </div>

    <!-- 메인 헤더 -->
    <header class="main-header">
        <div class="header-content">
            <h1>🏝️ 미야코지마</h1>
            <div class="header-info">
                <div class="date-info">
                    <span id="current-date">2025.9.27-10.1</span>
                    <span id="day-counter">Day 1/5</span>
                </div>
                <div class="weather-widget" id="weather-widget">
                    <span class="weather-icon">☀️</span>
                    <span class="weather-temp">26°C</span>
                </div>
            </div>
        </div>

        <!-- 네비게이션 -->
        <nav class="main-nav">
            <button class="nav-btn active" data-section="dashboard">
                <svg class="icon"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"></path></svg>
                대시보드
            </button>
            <button class="nav-btn" data-section="budget">
                <svg class="icon"><path d="M12 1v22m5-18H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                예산
            </button>
            <button class="nav-btn" data-section="itinerary">
                <svg class="icon"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                일정
            </button>
            <button class="nav-btn" data-section="poi">
                <svg class="icon"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                장소
            </button>
        </nav>
    </header>

    <!-- 메인 컨테이너 -->
    <main class="main-container">
        <!-- 대시보드 섹션 -->
        <section id="dashboard-section" class="section active">
            <div class="dashboard-grid">
                <!-- 예산 현황 카드 -->
                <div class="dashboard-card budget-overview">
                    <div class="card-header">
                        <h3>💰 오늘 예산 현황</h3>
                        <span class="budget-status" id="budget-status">양호</span>
                    </div>
                    <div class="budget-summary">
                        <div class="budget-item">
                            <span class="budget-label">사용</span>
                            <span class="budget-amount spent" id="today-spent">0 엔</span>
                        </div>
                        <div class="budget-item">
                            <span class="budget-label">남은 예산</span>
                            <span class="budget-amount remaining" id="today-remaining">20,000 엔</span>
                        </div>
                    </div>
                    <div class="budget-progress">
                        <div class="progress-bar">
                            <div class="progress-fill budget-progress-fill" id="budget-progress"></div>
                        </div>
                    </div>
                </div>

                <!-- 현재 위치 카드 -->
                <div class="dashboard-card location-card">
                    <div class="card-header">
                        <h3>📍 현재 위치</h3>
                        <button id="refresh-location" class="btn-icon">
                            <svg class="icon"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                        </button>
                    </div>
                    <div class="location-info">
                        <p class="current-location" id="current-location">위치 확인 중...</p>
                        <p class="location-detail" id="location-detail">GPS 신호를 찾고 있습니다</p>
                    </div>
                </div>

                <!-- 다음 목적지 카드 -->
                <div class="dashboard-card next-destination">
                    <div class="card-header">
                        <h3>🎯 다음 목적지</h3>
                        <span class="eta" id="next-eta">15분</span>
                    </div>
                    <div class="destination-info">
                        <h4 id="next-destination-name">요나하 마에하마 비치</h4>
                        <p id="next-destination-desc">동양 최고의 해변, 일몰 명소</p>
                        <div class="destination-actions">
                            <button class="btn-primary" id="start-navigation">길찾기 시작</button>
                            <button class="btn-secondary" id="change-destination">변경</button>
                        </div>
                    </div>
                </div>

                <!-- 오늘의 추천 카드 -->
                <div class="dashboard-card recommendations">
                    <div class="card-header">
                        <h3>✨ 오늘의 추천</h3>
                        <button id="refresh-recommendations" class="btn-icon">
                            <svg class="icon"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                        </button>
                    </div>
                    <div class="recommendations-list" id="recommendations-list">
                        <div class="recommendation-item">
                            <div class="rec-icon">🌅</div>
                            <div class="rec-content">
                                <h5>일출 감상</h5>
                                <p>이라부 대교에서 6:30 일출</p>
                            </div>
                            <span class="rec-distance">2.3km</span>
                        </div>
                    </div>
                </div>

                <!-- 빠른 액션 카드 -->
                <div class="dashboard-card quick-actions">
                    <div class="card-header">
                        <h3>🚀 빠른 액션</h3>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" id="add-expense">
                            <svg class="icon"><path d="M12 1v22m5-18H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                            지출 추가
                        </button>
                        <button class="action-btn" id="scan-receipt">
                            <svg class="icon"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21,15 16,10 5,21"></polyline></svg>
                            영수증 스캔
                        </button>
                        <button class="action-btn" id="nearby-pois">
                            <svg class="icon"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                            주변 장소
                        </button>
                        <button class="action-btn" id="emergency-help">
                            <svg class="icon"><path d="m13 2-2 2.5h-4l2 2.5-2 2.5h4l2 2.5 2-2.5h4l-2-2.5 2-2.5h-4l-2-2.5z"></path></svg>
                            도움말
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 예산 섹션 -->
        <section id="budget-section" class="section">
            <div class="section-header">
                <h2>💰 예산 관리</h2>
                <div class="section-actions">
                    <button class="btn-primary" id="add-expense-btn">지출 추가</button>
                    <button class="btn-secondary" id="export-budget">내보내기</button>
                </div>
            </div>

            <div class="budget-content">
                <!-- 예산 차트 -->
                <div class="budget-chart-container">
                    <canvas id="budget-chart" width="400" height="200"></canvas>
                </div>

                <!-- 카테고리별 예산 -->
                <div class="budget-categories" id="budget-categories">
                    <!-- 동적으로 생성 -->
                </div>

                <!-- 최근 지출 내역 -->
                <div class="recent-expenses">
                    <h3>최근 지출</h3>
                    <div class="expense-list" id="expense-list">
                        <!-- 동적으로 생성 -->
                    </div>
                </div>
            </div>
        </section>

        <!-- 일정 섹션 -->
        <section id="itinerary-section" class="section">
            <div class="section-header">
                <h2>📅 일정 관리</h2>
                <div class="date-selector">
                    <button class="date-btn active" data-date="2025-09-27">27일</button>
                    <button class="date-btn" data-date="2025-09-28">28일</button>
                    <button class="date-btn" data-date="2025-09-29">29일</button>
                    <button class="date-btn" data-date="2025-09-30">30일</button>
                    <button class="date-btn" data-date="2025-10-01">01일</button>
                </div>
            </div>

            <div class="itinerary-content">
                <div class="timeline" id="itinerary-timeline">
                    <!-- 동적으로 생성 -->
                </div>
            </div>
        </section>

        <!-- POI 섹션 -->
        <section id="poi-section" class="section">
            <div class="section-header">
                <h2>🗺️ 장소 탐색</h2>
                <div class="search-filters">
                    <input type="search" id="poi-search" placeholder="장소 검색...">
                    <select id="category-filter">
                        <option value="">전체 카테고리</option>
                        <option value="nature_views">자연 경관</option>
                        <option value="dining_cafe">식당/카페</option>
                        <option value="shopping">쇼핑</option>
                        <option value="culture_spots">문화 명소</option>
                        <option value="marine_activities">해양 활동</option>
                    </select>
                </div>
            </div>

            <div class="poi-content">
                <div class="poi-map" id="poi-map">
                    <!-- 지도가 여기에 로드됩니다 -->
                </div>
                <div class="poi-list" id="poi-list">
                    <!-- 동적으로 생성 -->
                </div>
            </div>
        </section>
    </main>

    <!-- 플로팅 액션 버튼 -->
    <div class="fab-container">
        <button class="fab-main" id="fab-main">
            <svg class="icon"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        </button>
        <div class="fab-menu" id="fab-menu">
            <button class="fab-item" data-action="expense">💰</button>
            <button class="fab-item" data-action="camera">📸</button>
            <button class="fab-item" data-action="location">📍</button>
            <button class="fab-item" data-action="note">📝</button>
        </div>
    </div>

    <!-- 모달들 -->

    <!-- 지출 추가 모달 -->
    <div id="expense-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>지출 추가</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="expense-form">
                <div class="form-group">
                    <label for="expense-amount">금액 (JPY)</label>
                    <input type="number" id="expense-amount" required>
                </div>
                <div class="form-group">
                    <label for="expense-category">카테고리</label>
                    <select id="expense-category" required>
                        <option value="">선택하세요</option>
                        <option value="meals">식비</option>
                        <option value="transportation">교통</option>
                        <option value="activities">액티비티</option>
                        <option value="shopping">쇼핑</option>
                        <option value="other">기타</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="expense-description">설명</label>
                    <input type="text" id="expense-description" placeholder="선택사항">
                </div>
                <div class="form-group">
                    <label for="expense-location">장소</label>
                    <input type="text" id="expense-location" placeholder="현재 위치 사용" readonly>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="cancel-expense">취소</button>
                    <button type="submit" class="btn-primary">추가</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 알림 토스트 -->
    <div id="toast-container" class="toast-container">
        <!-- 동적으로 생성 -->
    </div>

    <!-- 오프라인 표시 -->
    <div id="offline-indicator" class="offline-indicator">
        <span>오프라인 모드</span>
        <svg class="icon"><circle cx="12" cy="12" r="2"></circle><path d="m4.93 4.93 14.14 14.14"></path></svg>
    </div>

    <!-- JavaScript - 의존성 순서 중요 -->
    <!-- Phase 1: 기본 설정 -->
    <script type="module" src="./js/config.js"></script>
    <script type="module" src="./js/utils.js"></script>

    <!-- Phase 2: 저장소 및 API -->
    <script type="module" src="./js/storage.js"></script>
    <script type="module" src="./js/api.js"></script>

    <!-- Phase 3: 핵심 모듈 -->
    <script type="module" src="./js/modules/navigation.js"></script>
    <script type="module" src="./js/modules/share.js"></script>

    <!-- Phase 4: 비즈니스 로직 모듈 -->
    <script type="module" src="./js/budget.js"></script>
    <script type="module" src="./js/location.js"></script>
    <script type="module" src="./js/maps.js"></script>
    <script type="module" src="./js/itinerary.js"></script>
    <script type="module" src="./js/poi.js"></script>
    <script type="module" src="./js/dashboard.js"></script>
    <script type="module" src="./js/chart.js"></script>

    <!-- Phase 5: 메인 애플리케이션 -->
    <script type="module" src="./js/app.js"></script>

    <!-- Service Worker 등록 -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>