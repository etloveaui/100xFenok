<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multichart v3 - Event Horizon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              brand: {
                navy: '#010079',
                gold: '#D5AD36',
                interactive: '#1B73D3',
                bg: '#f8fafc',
              }
            }
          }
        }
      }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --nav-height: 60px; }
        body { background-color: #f8fafc; font-family: 'Noto Sans KR', sans-serif; color: #1e293b; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        /* Nav */
        .nav-edgy {
            height: var(--nav-height); flex-shrink: 0;
            background: white; border-bottom: 1px solid #e2e8f0;
            display: flex; justify-content: space-between; align-items: center; padding: 0 1.5rem;
            z-index: 50;
        }

        /* Layout */
        .horizon-container { flex: 1; display: flex; flex-direction: column; padding: 1rem; gap: 1rem; overflow: hidden; }

        /* Main Chart Area */
        .chart-stage { flex: 3; background: white; border-radius: 12px; border: 1px solid #e2e8f0; padding: 1rem; position: relative; }
        
        /* Event Swimlane */
        .event-swimlane {
            flex: 1; background: white; border-radius: 12px; border: 1px solid #e2e8f0; padding: 1rem;
            display: flex; flex-direction: column; overflow-x: auto;
        }
        
        .timeline-track { position: relative; flex: 1; min-width: 1000px; display: flex; align-items: center; border-top: 2px solid #e2e8f0; margin-top: 1rem; }
        
        .event-node {
            position: absolute; top: -24px; transform: translateX(-50%);
            display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: all 0.2s;
        }
        .event-node:hover { transform: translateX(-50%) scale(1.1); z-index: 10; }
        
        .node-dot {
            width: 12px; height: 12px; border-radius: 50%; background: white; border: 2px solid #64748b; margin-bottom: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .node-dot.cpi { border-color: #ef4444; background: #fee2e2; }
        .node-dot.fomc { border-color: #010079; background: #e0e7ff; }
        .node-dot.earnings { border-color: #16a34a; background: #dcfce7; }

        .node-label { font-size: 0.7rem; font-weight: 700; color: #64748b; background: white; padding: 2px 6px; border-radius: 4px; border: 1px solid #e2e8f0; white-space: nowrap; }
        
        .connection-line {
            position: absolute; top: 0; bottom: 0; width: 1px; border-left: 1px dashed #94a3b8; opacity: 0; pointer-events: none; transition: opacity 0.2s;
        }
        .event-node:hover + .connection-line, .connection-line.active { opacity: 1; }

    </style>
</head>
<body>

    <nav class="nav-edgy">
        <div class="flex items-center gap-3">
            <span class="font-[800] text-slate-800 text-lg">EVENT HORIZON</span>
            <span class="px-2 py-1 bg-slate-100 rounded text-xs font-bold text-slate-500">Macro Correlation</span>
        </div>
        <div class="flex gap-2">
            <button class="px-3 py-1.5 bg-brand-navy text-white text-xs font-bold rounded-lg shadow-md hover:bg-blue-900">
                <i class="fas fa-plus mr-1"></i> Add Ticker
            </button>
        </div>
    </nav>

    <main class="horizon-container">
        
        <!-- Main Chart -->
        <div class="chart-stage">
            <canvas id="mainChart"></canvas>
        </div>

        <!-- Event Timeline -->
        <div class="event-swimlane custom-scrollbar">
            <div class="flex justify-between items-center mb-2 sticky left-0">
                <h3 class="text-xs font-bold text-slate-500 uppercase">Macro Events Timeline</h3>
                <div class="flex gap-2 text-[10px] font-bold">
                    <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-red-100 border border-red-500"></span> CPI/PPI</span>
                    <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-100 border border-blue-800"></span> FOMC</span>
                    <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-green-100 border border-green-500"></span> Earnings</span>
                </div>
            </div>
            
            <div class="timeline-track" id="timeline">
                <!-- Events injected via JS -->
            </div>
        </div>

    </main>

    <script>
        // Register Annotation Plugin
        Chart.register(window['chartjs-plugin-annotation']);

        const ctx = document.getElementById('mainChart').getContext('2d');
        
        // Mock Data
        const labels = Array.from({length: 60}, (_, i) => `Day ${i}`);
        const tqqqData = labels.map((_, i) => 50 + Math.random() * 10 + i * 0.5);
        const soxlData = labels.map((_, i) => 30 + Math.random() * 15 + i * 0.3);

        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'TQQQ',
                        data: tqqqData,
                        borderColor: '#010079',
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 0
                    },
                    {
                        label: 'SOXL',
                        data: soxlData,
                        borderColor: '#D5AD36',
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: { position: 'top', align: 'end' },
                    annotation: {
                        annotations: {} // Filled dynamically
                    }
                },
                scales: {
                    x: { grid: { display: false } },
                    y: { grid: { color: '#f1f5f9' } }
                }
            }
        });

        // Event Data
        const events = [
            { day: 10, type: 'cpi', label: 'CPI 3.2%', impact: 'High' },
            { day: 25, type: 'fomc', label: 'Rate Hike', impact: 'High' },
            { day: 40, type: 'earnings', label: 'NVDA Earn', impact: 'Med' },
            { day: 55, type: 'cpi', label: 'CPI 3.0%', impact: 'High' }
        ];

        const timeline = document.getElementById('timeline');

        events.forEach(ev => {
            const leftPos = (ev.day / 60) * 100; // % Position
            
            const node = document.createElement('div');
            node.className = 'event-node';
            node.style.left = `${leftPos}%`;
            node.innerHTML = `
                <div class="node-dot ${ev.type}"></div>
                <div class="node-label">${ev.label}</div>
            `;
            
            // Hover Interaction
            node.addEventListener('mouseenter', () => {
                chart.options.plugins.annotation.annotations[`line${ev.day}`] = {
                    type: 'line',
                    xMin: ev.day - 1, // approximate index
                    xMax: ev.day - 1,
                    borderColor: '#94a3b8',
                    borderWidth: 1,
                    borderDash: [5, 5],
                    label: { display: true, content: ev.label, position: 'start', backgroundColor: 'rgba(0,0,0,0.7)', font: {size: 10} }
                };
                chart.update('none');
            });

            node.addEventListener('mouseleave', () => {
                delete chart.options.plugins.annotation.annotations[`line${ev.day}`];
                chart.update('none');
            });

            timeline.appendChild(node);
        });

    </script>
</body>
</html>
