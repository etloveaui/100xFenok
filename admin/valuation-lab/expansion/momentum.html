<!DOCTYPE html>
<html lang="ko" class="antialiased">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>Momentum Dashboard - 100xFenok</title>
<meta name="theme-color" content="#22c55e">
<meta name="mobile-web-app-capable" content="yes">
<link rel="icon" href="../../favicon.ico">
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config={darkMode:'class',theme:{extend:{fontSize:{xs:'.75rem',sm:'.875rem',base:'1rem'},animation:{'fade-in':'fadeIn .3s ease-out','slide-up':'slideUp .3s ease-out'},keyframes:{fadeIn:{from:{opacity:0},to:{opacity:1}},slideUp:{from:{opacity:0,transform:'translateY(10px)'},to:{opacity:1,transform:'translateY(0)'}}}}}
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
@media (max-width:640px){body{font-size:16px!important}.touch-target{min-height:44px!important;min-width:44px!important}.chart-mobile{height:280px!important}}
@media (max-width:380px){.xs\:hidden{display:none!important}}
</style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-300">
<div id="toast-container" class="fixed top-4 right-4 z-50 flex flex-col gap-2 pointer-events-none max-w-[calc(100vw-2rem)]"></div>
<div id="pull-refresh" class="pull-refresh bg-gradient-to-r from-blue-500 to-purple-500 text-white"><i class="fas fa-arrow-down mr-2"></i><span class="text-sm font-medium">ë‹¹ê¸°ë©´ ìƒˆë¡œê³ ì¹¨</span></div>

<header class="glass sticky top-0 z-50 border-b border-gray-200/50 dark:border-gray-700/50 safe-area-top">
<div class="container mx-auto px-3 py-3">
<div class="flex items-center justify-between gap-2">
<div class="flex items-center gap-3">
<div class="relative group touch-target rounded-lg">
<div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-green-400 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg shadow-green-500/30 transition-shadow cursor-pointer active:scale-95" onclick="toggleQ()" tabindex="0" role="button"><i class="fas fa-rocket text-white text-lg sm:text-xl"></i></div>
</div>
<div>
<h1 class="text-base sm:text-xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent whitespace-nowrap">Momentum</h1>
<div class="flex items-center gap-1.5 text-xs sm:text-sm whitespace-nowrap"><span class="text-gray-500">P/E:</span><span class="text-green-600 dark:text-green-400 font-medium">+434%</span><span class="text-gray-400">/</span><span class="text-red-500 font-medium">+49%</span></div>
</div>
</div>
<div class="flex items-center gap-1 sm:gap-2">
<div id="data-freshness" class="hidden sm:flex items-center gap-1.5 px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded-lg touch-target"><div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div><span class="text-xs text-gray-600 dark:text-gray-400" id="relative-time">-</span></div>
<button onclick="toggleFavV()" class="touch-target p-2 rounded-lg text-gray-500 hover:text-yellow-500 active:bg-yellow-50" title="ì¦ê²¨ì°¾ê¸°"><i class="fas fa-star text-base" id="fav-icon"></i></button>
<button onclick="toggleD()" class="touch-target p-2 rounded-lg text-gray-500 hover:text-blue-500 active:bg-blue-50" title="ë‹¤í¬ ëª¨ë“œ"><i class="fas fa-moon dark:hidden text-base"></i><i class="fas fa-sun hidden dark:inline text-base"></i></button>
<button onclick="refresh()" class="touch-target p-2 rounded-lg text-gray-500 hover:text-green-600 active:bg-green-50" title="ìƒˆë¡œê³ ì¹¨"><i class="fas fa-sync-alt text-base" id="refresh-icon"></i></button>
</div>
</div>
</div>
</header>

<div id="quick-actions-backdrop" onclick="closeQ()" class="hidden fixed inset-0 z-40 bg-black/20 dark:bg-black/40"></div>

<main class="container mx-auto px-3 py-4 relative" id="main-content">
<div id="compare-banner" class="hidden mb-4">
<div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-3 text-white shadow-lg">
<div class="flex items-center justify-between">
<div class="flex items-center gap-2"><div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i class="fas fa-balance-scale text-sm"></i></div><div><h3 class="font-bold text-sm">ë¹„êµ ëª¨ë“œ</h3><p class="text-xs opacity-90">2ê°œ ì„ íƒ</p></div></div><button onclick="toggleCmp()" class="px-3 py-1.5 bg-white/20 rounded-lg text-xs font-medium active:bg-white/30">ì¢…ë£Œ</button>
</div>
</div>
</div>

<section class="mb-4">
<div class="flex gap-1.5 overflow-x-auto pb-2 scrollbar-hide -webkit-overflow-scrolling:touch" style="scroll-snap-type:x mandatory" role="tablist" aria-label="ì¸ë±ìŠ¤ ê·¸ë£¹">
<button class="index-chip touch-target flex-shrink-0 px-3 py-2 sm:px-4 sm:py-2.5 text-xs sm:text-sm rounded-lg font-medium shadow-sm bg-blue-500 text-white scroll-snap-align" data-group="us" role="tab" aria-selected="true">ğŸ‡ºğŸ‡¸<span class="hidden sm:inline"> US</span></button>
<button class="index-chip touch-target flex-shrink-0 px-3 py-2 sm:px-4 sm:py-2.5 text-xs sm:text-sm rounded-lg font-medium shadow-sm bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 scroll-snap-align" data-group="sec" role="tab" aria-selected="false">ğŸ“Š<span class="hidden sm:inline"> Sectors</span></button>
<button class="index-chip touch-target flex-shrink-0 px-3 py-2 sm:px-4 sm:py-2.5 text-xs sm:text-sm rounded-lg font-medium shadow-sm bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 scroll-snap-align" data-group="dev" role="tab" aria-selected="false">ğŸŒ<span class="hidden sm:inline"> Developed</span></button>
<button class="index-chip touch-target flex-shrink-0 px-3 py-2 sm:px-4 sm:py-2.5 text-xs sm:text-sm rounded-lg font-medium shadow-sm bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 scroll-snap-align" data-group="em" role="tab" aria-selected="false">ğŸŒ<span class="hidden sm:inline"> Emerging</span></button>
<button class="index-chip touch-target flex-shrink-0 px-3 py-2 sm:px-4 sm:py-2.5 text-xs sm:text-sm rounded-lg font-medium shadow-sm bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 scroll-snap-align" data-group="msci" role="tab" aria-selected="false">ğŸ“ˆ<span class="hidden sm:inline"> MSCI</span></button>
<button class="index-chip touch-target flex-shrink-0 px-3 py-2 sm:px-4 sm:py-2.5 text-xs sm:text-sm rounded-lg font-medium shadow-sm bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 scroll-snap-align" data-group="micro" role="tab" aria-selected="false">ğŸ”¬<span class="hidden sm:inline"> Micro</span></button>
</div>
</section>

<section class="mb-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
<div class="glass rounded-xl p-4 shadow-lg">
<div class="flex items-center justify-between mb-3">
<h2 class="text-xs sm:text-sm font-bold text-green-600 dark:text-green-400 flex items-center gap-1.5"><i class="fas fa-crown"></i><span>Top 5</span></h2>
<span class="text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 px-2 py-0.5 rounded-lg">6M</span>
</div>
<div id="top5-cards" class="space-y-2">
<div class="skeleton h-16 sm:h-20 rounded-lg"></div>
<div class="skeleton h-16 sm:h-20 rounded-lg"></div>
</div>
</div>
<div class="glass rounded-xl p-4 shadow-lg">
<div class="flex items-center justify-between mb-3">
<h2 class="text-xs sm:text-sm font-bold text-red-600 dark:text-red-400 flex items-center gap-1.5"><i class="fas fa-exclamation-circle"></i><span>Bottom 5</span></h2>
<span class="text-xs bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 px-2 py-0.5 rounded-lg">6M</span>
</div>
<div id="bottom5-cards" class="space-y-2">
<div class="skeleton h-16 sm:h-20 rounded-lg"></div>
<div class="skeleton h-16 sm:h-20 rounded-lg"></div>
</div>
</div>
</section>

<section class="mb-4">
<div class="glass rounded-xl shadow-lg overflow-hidden">
<div class="p-3 border-b border-gray-200/50 dark:border-gray-700/50 flex flex-col sm:flex-row sm:items-center justify-between gap-2">
<div class="flex items-center gap-2">
<h2 class="text-xs sm:text-sm font-bold text-gray-700 dark:text-gray-200 flex items-center gap-1.5"><i class="fas fa-table text-amber-500"></i><span>Overview</span><span id="table-count" class="text-xs font-normal text-gray-400 bg-gray-100 dark:bg-gray-800 px-1.5 py-0.5 rounded-full">-</span></h2>
</div>
<div class="relative w-full sm:w-48">
<input type="text" id="table-search" placeholder="ê²€ìƒ‰..." class="w-full pl-8 pr-3 py-2 text-sm border-2 border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 touch-target" aria-label="ê²€ìƒ‰">
<i class="fas fa-search absolute left-2.5 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i>
</div>
</div>
<div id="momentum-table" class="overflow-x-auto -webkit-overflow-scrolling:touch"></div>
<div class="p-2.5 bg-gray-50/80 dark:bg-gray-800/80 border-t border-gray-200/50 dark:border-gray-700/50 flex items-center justify-between text-xs text-gray-500">
<div class="flex items-center gap-3 overflow-x-auto"><span>ì •ë ¬: í—¤ë”</span><span>ê²€ìƒ‰: ì…ë ¥</span><span class="hidden xs:inline">/?:ë‹¨ì¶•í‚¤</span></div><span id="last-updated" class="whitespace-nowrap"></span>
</div>
</div>
</section>

<section class="mb-4">
<div class="glass rounded-xl shadow-lg p-4">
<div class="flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-3">
<h2 class="text-xs sm:text-sm font-bold text-gray-700 dark:text-gray-200 flex items-center gap-1.5"><i class="fas fa-chart-line text-purple-500"></i><span>Yearly Returns</span></h2>
<div class="flex flex-wrap items-center gap-1.5">
<button onclick="chartAll()" class="touch-target px-2.5 py-1.5 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded-lg font-medium active:bg-blue-200">ì „ì²´</button>
<button onclick="chartTop5()" class="touch-target px-2.5 py-1.5 text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-lg font-medium active:bg-green-200">Top5</button>
<button onclick="chartClear()" class="touch-target px-2.5 py-1.5 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg active:bg-gray-200">ì´ˆê¸°í™”</button>
<div class="w-px h-5 bg-gray-300 dark:bg-gray-600 mx-1"></div>
<button onclick="exportChart()" class="touch-target px-2.5 py-1.5 text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 rounded-lg font-medium flex items-center gap-1 active:bg-purple-200"><i class="fas fa-camera"></i><span class="hidden sm:inline">PNG</span></button>
<button onclick="exportCSV()" class="touch-target px-2.5 py-1.5 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg flex items-center gap-1 active:bg-gray-200"><i class="fas fa-file-csv"></i><span class="hidden sm:inline">CSV</span></button>
</div>
</div>
<div class="chart-mobile relative w-full" style="height:280px;min-height:200px">
<canvas id="chartCanvas"></canvas>
<div id="chart-empty" class="hidden absolute inset-0 flex items-center justify-center bg-white/80 dark:bg-gray-900/80 rounded-lg">
<div class="text-center text-gray-500"><i class="fas fa-chart-line text-2xl sm:text-4xl mb-2"></i><p class="text-xs sm:text-sm">ì¸ë±ìŠ¤ ì„ íƒ</p><p class="text-xs mt-1 opacity-75">í–‰ í´ë¦­</p></div>
</div>
</div>
</div>
</section>
</main>

<div id="quick-actions" class="quick-actions hidden fixed top-16 left-2 sm:left-auto sm:right-4 z-50 w-44 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 py-2">
<button onclick="toggleD();closeQ()" class="w-full px-4 py-2.5 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-3 touch-target"><i class="fas fa-moon w-5 text-center"></i>ë‹¤í¬ ëª¨ë“œ</button>
<button onclick="toggleCmp();closeQ()" class="w-full px-4 py-2.5 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-3 touch-target"><i class="fas fa-balance-scale w-5 text-center"></i>ë¹„êµ ëª¨ë“œ</button>
<button onclick="exportChart();closeQ()" class="w-full px-4 py-2.5 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-3 touch-target"><i class="fas fa-image w-5 text-center"></i>ì°¨íŠ¸ ì €ì¥</button>
<button onclick="M.shareShow();closeQ()" class="w-full px-4 py-2.5 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-3 touch-target"><i class="fas fa-share-alt w-5 text-center"></i>ê³µìœ í•˜ê¸°</button>
<hr class="my-1.5 border-gray-200 dark:border-gray-700">
<button onclick="M.showK();closeQ()" class="w-full px-4 py-2.5 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-3 touch-target"><i class="fas fa-keyboard w-5 text-center"></i>ë‹¨ì¶•í‚¤</button>
</div>

<div id="detail-modal" class="hidden fixed inset-0 bg-black/50 z-50 overflow-y-auto">
<div class="min-h-screen flex items-center justify-center p-3">
<div class="fixed inset-0 bg-black/50" onclick="M.closeM()"></div>
<div class="modal-content relative bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-lg w-full overflow-hidden">
<div class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
<div><h3 id="modal-title" class="text-lg sm:text-xl font-bold"></h3><p id="modal-subtitle" class="text-xs text-gray-500 mt-0.5"></p></div><button onclick="M.closeM()" class="touch-target p-2 rounded-lg text-gray-400 hover:text-gray-600 active:bg-gray-100"><i class="fas fa-times text-lg"></i></button>
</div>
<div class="p-4 max-h-[50vh] overflow-y-auto" id="modal-content"></div>
</div>
</div>
</div>

<div id="shortcuts-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-3">
<div class="fixed inset-0 bg-black/50" onclick="M.closeK()"></div>
<div class="modal-content relative bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-xs sm:max-w-md w-full p-4">
<div class="flex items-center justify-between mb-3">
<h3 class="text-base sm:text-lg font-bold"><i class="fas fa-keyboard mr-2 text-blue-500"></i>Shortcuts</h3><button onclick="M.closeK()" class="touch-target p-2 rounded-lg text-gray-400 hover:text-gray-600 active:bg-gray-100"><i class="fas fa-times"></i></button>
</div>
<div class="space-y-1 text-sm">
<div class="flex justify-between py-2 border-b dark:border-gray-700"><span class="text-gray-600 dark:text-gray-400">ìƒˆë¡œê³ ì¹¨</span><kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">R</kbd></div>
<div class="flex justify-between py-2 border-b dark:border-gray-700"><span class="text-gray-600 dark:text-gray-400">ê²€ìƒ‰</span><kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">/</kbd></div>
<div class="flex justify-between py-2 border-b dark:border-gray-700"><span class="text-gray-600 dark:text-gray-400">ë‹¤í¬ ëª¨ë“œ</span><kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">D</kbd></div>
<div class="flex justify-between py-2 border-b dark:border-gray-700"><span class="text-gray-600 dark:text-gray-400">ë¹„êµ ëª¨ë“œ</span><kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">C</kbd></div>
<div class="flex justify-between py-2"><span class="text-gray-600 dark:text-gray-400">ë„ì›€ë§</span><kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">?</kbd></div>
</div>
</div>
</div>

<div id="share-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-3">
<div class="fixed inset-0 bg-black/50" onclick="M.shareClose()"></div>
<div class="modal-content relative bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-xs sm:max-w-sm w-full p-4">
<h3 class="text-base sm:text-lg font-bold mb-3"><i class="fas fa-share-alt mr-2 text-blue-500"></i>Share</h3>
<div class="space-y-2">
<button onclick="M.shareCopy()" class="w-full py-2.5 px-4 bg-blue-500 text-white rounded-lg font-medium flex items-center justify-center gap-2 touch-target active:bg-blue-600"><i class="fas fa-link"></i>Copy Link</button>
<button onclick="M.shareTW()" class="w-full py-2.5 px-4 bg-sky-500 text-white rounded-lg font-medium flex items-center justify-center gap-2 touch-target active:bg-sky-600"><i class="fab fa-twitter"></i>Twitter</button>
</div>
</div>
</div>

<footer class="border-t border-gray-200/50 dark:border-gray-700/50 glass py-3 mt-auto">
<div class="container mx-auto px-3 text-center text-xs text-gray-500">
<p class="font-medium">Momentum Dashboard v3.7</p>
<p class="mt-0.5 opacity-75">Bloomberg Data â€¢ P/E Band: +434% vs +49%</p>
</div>
</footer>

<div class="safe-area-bottom h-4 sm:h-0"></div>

<!-- Shared Components -->
<script src="../../shared/core/formatters.js"></script>
<script src="../../shared/ui/metric-card.js"></script>
<script src="../../shared/ui/data-table.js"></script>

<style>
.safe-area-top{padding-top:env(safe-area-inset-top,0)}
.safe-area-bottom{padding-bottom:env(safe-area-inset-bottom,0)}
:root{--g:#fff;--b:#fff3}.dark{--g:#1e1e1e;--b:#fff1}body{transition:.3s;-webkit-tap-highlight-color:transparent}.glass{background:var(--g);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid var(--b)}.metric-card{transition:.3s}.metric-card:hover{transform:translateY(-4px) scale(1.01);box-shadow:0 15px 30px -10px rgba(0,0,0,.12)}.index-chip{cursor:pointer;transition:.2s;white-space:nowrap}.index-chip:hover{transform:translateY(-2px) scale(1.02)}.index-chip.active{transform:scale(1.02);box-shadow:0 6px 20px rgba(59,130,246,.35)}.table-row{transition:.2s}.table-row:hover{transform:translateX(2px)}.modal-content{animation:si .2s}.skeleton{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:sha 1.5s infinite}.dark .skeleton{background:linear-gradient(90deg,#374151 25%,#4b5563 50%,#374151 75%);background-size:200% 100%}::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-thumb{background:rgba(156,163,175,.4);border-radius:3px}.scrollbar-hide{scrollbar-width:none;-ms-overflow-style:none}.scrollbar-hide::-webkit-scrollbar{display:none}.pull-refresh{position:absolute;top:-60px;left:0;right:0;height:60px;display:flex;align-items:center;justify-content:center;transition:top .3s}.pull-refresh.active{top:0}.toast-enter{animation:sir .3s}.quick-actions{animation:si .2s}@keyframes sha{from{background-position:-200% 0}to{background-position:200% 0}}@keyframes si{from{opacity:0;transform:scale(.97)}to{opacity:1;transform:scale(1)}}@keyframes sir{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
</style>

<script>
    // Index groups configuration
    const INDEX_GROUPS = {
      us: ['sp500', 'nasdaq100', 'nasdaq_composite', 'russell2000'],
      sec: ['information_technology', 'health_care', 'financials', 'consumer_discretionary', 'communication_services', 'industrials', 'consumer_staples', 'energy', 'utilities', 'real_estate', 'materials', 'homebuilders'],
      dev: ['euro_stoxx_50', 'topix', 'hong_kong', 'nikkei'],
      em: ['shanghai', 'india_sensex', 'kospi', 'brazil', 'vietnam', 'hang_seng_h'],
      msci: ['world', 'developed', 'emerging', 'china', 'india', 'korea'],
      micro: ['philadelphia_semi', 'us_regional_banks', 'hang_seng_tech', 'us_biotech']
    };

    // Display names
    const INDEX_NAMES = {
      sp500: 'S&P 500',
      nasdaq100: 'Nasdaq 100',
      nasdaq_composite: 'Nasdaq Composite',
      russell2000: 'Russell 2000',
      information_technology: 'Info Tech',
      health_care: 'Healthcare',
      financials: 'Financials',
      consumer_discretionary: 'Consumer Disc',
      communication_services: 'Comm Services',
      industrials: 'Industrials',
      consumer_staples: 'Consumer Staples',
      energy: 'Energy',
      utilities: 'Utilities',
      real_estate: 'Real Estate',
      materials: 'Materials',
      homebuilders: 'Homebuilders',
      euro_stoxx_50: 'Euro Stoxx 50',
      topix: 'TOPIX',
      hong_kong: 'Hong Kong',
      nikkei: 'Nikkei 225',
      shanghai: 'Shanghai',
      india_sensex: 'India Sensex',
      kospi: 'KOSPI',
      brazil: 'Bovespa',
      vietnam: 'VN-Index',
      hang_seng_h: 'HSCEI',
      world: 'MSCI World',
      developed: 'MSCI Dev',
      emerging: 'MSCI EM',
      china: 'MSCI China',
      india: 'MSCI India',
      korea: 'MSCI Korea',
      philadelphia_semi: 'SOX',
      us_regional_banks: 'Regional Banks',
      hang_seng_tech: 'HS Tech',
      us_biotech: 'Biotech'
    };

    // Chart colors
    const CHART_COLORS = ['#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316', '#6366f1'];

    // Constants
    const CACHE_DURATION = 5 * 60 * 1000;
    const STORAGE_KEYS = { d: 'mD', t: 'mT', fav: 'mFav' };
    const YEARS = ['2018', '2019', '2020', '2021', '2022', '2023', '2024', '2025'];

    // State
    let data = null;
    let chart = null;
    let currentGroup = 'us';
    let sortKey = '6m';
    let sortAsc = false;
    let compareMode = false;
    let searchQuery = '';
    let favorites = new Set();
    let lastUpdated = null;

    // DOM elements
    const $ = id => document.getElementById(id);
    const $$ = selector => document.querySelectorAll(selector);

    // Format helpers
    const fp = v => {
      const p = v * 100;
      return {
        v: p,
        s: p > 0 ? '+' : '',
        c: p > 0 ? 'text-green-600' : p < 0 ? 'text-red-600' : 'text-gray-500',
        t: (p > 0 ? '+' : '') + p.toFixed(1) + '%'
      };
    };

    const rt = d => {
      if (d < 60000) return 'ë°©ê¸ˆ ì „';
      if (d < 3600000) return Math.floor(d / 60000) + 'ë¶„ ì „';
      if (d < 86400000) return Math.floor(d / 3600000) + 'ì‹œê°„ ì „';
      return Math.floor(d / 86400000) + 'ì¼ ì „';
    };

    const toast = (msg, type = 'info') => {
      const container = $('toast-container');
      const toastEl = document.createElement('div');
      const icons = { success: 'fa-check-circle', error: 'fa-exclamation-circle', info: 'fa-info-circle', warning: 'fa-exclamation-triangle' };
      const colors = { success: 'bg-green-500', error: 'bg-red-500', info: 'bg-blue-500', warning: 'bg-amber-500' };
      toastEl.className = `toast-enter px-4 py-3 ${colors[type]} text-white rounded-lg shadow-lg flex items-center gap-2 text-sm`;
      toastEl.innerHTML = `<i class="fas ${icons[type]}"></i><span>${msg}</span>`;
      container.appendChild(toastEl);
      setTimeout(() => toastEl.remove(), 3000);
    };

    // Storage helpers
    const storage = {
      get: (k, def) => {
        try {
          const v = localStorage.getItem(k);
          if (v === null) return def;
          return k === STORAGE_KEYS.t ? Date.now() - (parseInt(v) || 0) : JSON.parse(v);
        } catch (e) { return def; }
      },
      set: (k, v) => {
        try { localStorage.setItem(k, typeof v === 'object' ? JSON.stringify(v) : v); } catch (e) {}
      }
    };

    // Initialize
    async function init() {
      try {
        const response = await fetch('../../../data/benchmarks/summaries.json');
        if (!response.ok) throw new Error('Failed to load data');
        data = await response.json();

        const now = Date.now();
        storage.set(STORAGE_KEYS.t, now);
        storage.set(STORAGE_KEYS.d, data);
        lastUpdated = now;

        render();
        setupEventListeners();

      } catch (error) {
        console.error('Init failed:', error);
        toast('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error');
      }
    }

    // Render all components
    function render() {
      renderTopBottom5();
      renderTable();
      renderChart();
      updateRelativeTime();
      updateFavorites();
    }

    // Render Top 5 and Bottom 5 cards
    function renderTopBottom5() {
      const indices = getAllIndices();
      const sorted = indices.map(key => ({
        key,
        name: INDEX_NAMES[key] || key,
        mom: data.momentum[key] || {},
        value: (data.momentum[key] || {})['6m'] || 0
      })).sort((a, b) => b.value - a.value);

      const top5 = sorted.slice(0, 5);
      const bottom5 = sorted.slice(-5).reverse();

      $('top5-cards').innerHTML = top5.map(item => createMetricCard(item, true)).join('');
      $('bottom5-cards').innerHTML = bottom5.map(item => createMetricCard(item, false)).join('');
    }

    function createMetricCard(item, isTop) {
      const f = fp(item.value);
      const emoji = item.value > 0 ? 'ğŸ“ˆ' : item.value < 0 ? 'ğŸ“‰' : 'â¡ï¸';

      return `
        <div class="metric-card ${isTop ? 'bg-gradient-to-br from-green-50 to-emerald-50 border-green-200' : 'bg-gradient-to-br from-red-50 to-rose-50 border-red-200'} rounded-xl p-4 border cursor-pointer hover:shadow-lg transition-all" onclick="showDetail('${item.key}')">
          <div class="flex items-center justify-between mb-2">
            <span class="text-xs font-medium text-gray-600 truncate flex-1">${item.name}</span>
            <span class="text-lg">${emoji}</span>
          </div>
          <div class="text-2xl font-bold ${f.c}">${f.s}${f.v.toFixed(1)}%</div>
          <div class="text-xs text-gray-400 mt-1">6ê°œì›” ìˆ˜ìµë¥ </div>
        </div>
      `;
    }

    // Render table
    function renderTable() {
      const indices = INDEX_GROUPS[currentGroup];
      const filtered = indices.filter(key => {
        const name = (INDEX_NAMES[key] || '').toLowerCase();
        return !searchQuery || name.includes(searchQuery.toLowerCase()) || key.includes(searchQuery.toLowerCase());
      });

      const rows = filtered.map(key => {
        const mom = data.momentum[key] || {};
        const f1m = fp(mom['1m'] || 0);
        const f3m = fp(mom['3m'] || 0);
        const f6m = fp(mom['6m'] || 0);
        const fytd = fp(mom.ytd || 0);

        return `
          <tr class="table-row border-b border-gray-100 hover:bg-gray-50 cursor-pointer" data-key="${key}" onclick="toggleCompare('${key}')">
            <td class="px-4 py-3 text-sm font-medium">${INDEX_NAMES[key] || key}</td>
            <td class="px-4 py-3 text-sm text-right ${f1m.c}">${f1m.t}</td>
            <td class="px-4 py-3 text-sm text-right ${f3m.c}">${f3m.t}</td>
            <td class="px-4 py-3 text-sm text-right ${f6m.c} font-semibold">${f6m.t}</td>
            <td class="px-4 py-3 text-sm text-right ${fytd.c}">${fytd.t}</td>
          </tr>
        `;
      }).join('');

      $('momentum-table').innerHTML = `
        <table class="w-full text-sm">
          <thead class="bg-gray-50 border-b border-gray-200">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Index</th>
              <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">1M</th>
              <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">3M</th>
              <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">6M</th>
              <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase">YTD</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;

      $('table-count').textContent = filtered.length;
    }

    // Render chart
    function renderChart() {
      const ctx = document.getElementById('chartCanvas').getContext('2d');
      const selected = getSelectedIndices();

      if (selected.length === 0) {
        $('chart-empty').classList.remove('hidden');
        if (chart) { chart.destroy(); chart = null; }
        return;
      }

      $('chart-empty').classList.add('hidden');

      const datasets = selected.map((key, i) => ({
        label: INDEX_NAMES[key] || key,
        data: YEARS.map(y => {
          const val = data.yearly_returns[key]?.[y];
          return val !== undefined ? val * 100 : null;
        }),
        borderColor: CHART_COLORS[i % CHART_COLORS.length],
        backgroundColor: CHART_COLORS[i % CHART_COLORS.length] + '20',
        tension: 0.3,
        fill: false,
        pointRadius: 4,
        pointHoverRadius: 6
      }));

      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'line',
        data: { labels: YEARS, datasets },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { intersect: false, mode: 'index' },
          plugins: {
            legend: { display: true, position: 'top', labels: { usePointStyle: true, boxWidth: 8 } },
            tooltip: {
              backgroundColor: 'rgba(255,255,255,0.95)',
              titleColor: '#1f2937',
              bodyColor: '#4b5563',
              borderColor: '#e5e7eb',
              borderWidth: 1,
              callbacks: {
                label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y?.toFixed(1)}%`
              }
            }
          },
          scales: {
            y: {
              title: { display: true, text: 'Return (%)' },
              grid: { color: 'rgba(0,0,0,0.05)' },
              ticks: { callback: v => v + '%' }
            },
            x: { grid: { display: false } }
          }
        }
      });
    }

    // Helper functions
    function getAllIndices() {
      return Object.values(INDEX_GROUPS).flat();
    }

    function getSelectedIndices() {
      const container = $('chart-empty');
      if (!container.classList.contains('hidden')) return [];
      const selected = Array.from(document.querySelectorAll('.table-row.bg-blue-50')).map(r => r.dataset.key);
      return selected.length > 0 ? selected : INDEX_GROUPS[currentGroup].slice(0, 5);
    }

    function updateRelativeTime() {
      const diff = Date.now() - (storage.get(STORAGE_KEYS.t, 0) || Date.now());
      $('relative-time').textContent = rt(diff);
    }

    function updateFavorites() {
      const fav = storage.get(STORAGE_KEYS.fav, []);
      favorites = new Set(fav);
      $('fav-icon').className = favorites.has(currentGroup) ? 'fas fa-star text-base text-yellow-500' : 'far fa-star text-base';
    }

    // Event handlers
    function setupEventListeners() {
      // Group tabs
      $$('.index-chip').forEach(chip => {
        chip.addEventListener('click', () => {
          $$('.index-chip').forEach(c => {
            c.classList.remove('bg-blue-500', 'text-white');
            c.classList.add('bg-white', 'dark:bg-gray-800', 'text-gray-700', 'dark:text-gray-200');
          });
          chip.classList.remove('bg-white', 'dark:bg-gray-800', 'text-gray-700', 'dark:text-gray-200');
          chip.classList.add('bg-blue-500', 'text-white');
          currentGroup = chip.dataset.group;
          render();
        });
      });

      // Search
      $('table-search').addEventListener('input', e => {
        searchQuery = e.target.value;
        renderTable();
      });

      // Refresh
      window.refresh = () => {
        $('refresh-icon').classList.add('animate-spin');
        init().finally(() => $('refresh-icon').classList.remove('animate-spin'));
      };

      // Dark mode
      window.toggleD = () => {
        document.documentElement.classList.toggle('dark');
        storage.set('dark', document.documentElement.classList.contains('dark'));
      };

      // Favorites
      window.toggleFavV = () => {
        if (favorites.has(currentGroup)) {
          favorites.delete(currentGroup);
          toast('ì¦ê²¨ì°¾ê¸° ì œê±°ë¨', 'info');
        } else {
          favorites.add(currentGroup);
          toast('ì¦ê²¨ì°¾ê¸° ì¶”ê°€ë¨', 'success');
        }
        storage.set(STORAGE_KEYS.fav, Array.from(favorites));
        updateFavorites();
      };

      // Quick actions
      window.toggleQ = () => {
        const qa = $('quick-actions');
        const backdrop = $('pull-refresh');
        qa.classList.toggle('hidden');
        backdrop.classList.toggle('active');
      };

      window.closeQ = () => {
        $('quick-actions').classList.add('hidden');
        $('pull-refresh').classList.remove('active');
      };

      // Chart controls
      window.chartAll = () => {
        $$('.table-row').forEach(r => r.classList.add('bg-blue-50'));
        renderChart();
      };

      window.chartTop5 = () => {
        $$('.table-row').forEach(r => r.classList.remove('bg-blue-50'));
        INDEX_GROUPS[currentGroup].slice(0, 5).forEach(key => {
          document.querySelector(`tr[data-key="${key}"]`)?.classList.add('bg-blue-50');
        });
        renderChart();
      };

      window.chartClear = () => {
        $$('.table-row').forEach(r => r.classList.remove('bg-blue-50'));
        renderChart();
      };

      // Compare mode
      window.toggleCmp = () => {
        compareMode = !compareMode;
        $('compare-banner').classList.toggle('hidden', !compareMode);
        toast(compareMode ? 'ë¹„êµ ëª¨ë“œ í™œì„±í™”' : 'ë¹„êµ ëª¨ë“œ ì¢…ë£Œ', 'info');
      };

      window.toggleCompare = (key) => {
        if (!compareMode) return;
        const row = document.querySelector(`tr[data-key="${key}"]`);
        row.classList.toggle('bg-blue-50');
        renderChart();
      };

      // Export
      window.exportChart = () => {
        const link = document.createElement('a');
        link.download = 'momentum-chart.png';
        link.href = document.getElementById('chartCanvas').toDataURL();
        link.click();
        toast('ì°¨íŠ¸ ì €ì¥ë¨', 'success');
      };

      window.exportCSV = () => {
        const indices = INDEX_GROUPS[currentGroup];
        const rows = indices.map(key => {
          const mom = data.momentum[key] || {};
          return [key, mom['1m'], mom['3m'], mom['6m'], mom.ytd].join(',');
        });
        const csv = 'Index,1M,3M,6M,YTD\n' + rows.join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const link = document.createElement('a');
        link.download = 'momentum-data.csv';
        link.href = URL.createObjectURL(blob);
        link.click();
        toast('CSV ì €ì¥ë¨', 'success');
      };

      // Detail modal
      window.showDetail = (key) => {
        const mom = data.momentum[key] || {};
        const returns = data.yearly_returns[key] || {};
        const f = fp;

        $('modal-title').textContent = INDEX_NAMES[key] || key;
        $('modal-subtitle').textContent = 'Momentum & Yearly Returns';
        $('modal-content').innerHTML = `
          <div class="space-y-4">
            <div class="grid grid-cols-2 gap-3">
              <div class="bg-gray-50 rounded-lg p-3 text-center">
                <div class="text-xs text-gray-500 mb-1">1ê°œì›”</div>
                <div class="text-lg font-bold ${f(mom['1m'] || 0).c}">${f(mom['1m'] || 0).t}</div>
              </div>
              <div class="bg-gray-50 rounded-lg p-3 text-center">
                <div class="text-xs text-gray-500 mb-1">3ê°œì›”</div>
                <div class="text-lg font-bold ${f(mom['3m'] || 0).c}">${f(mom['3m'] || 0).t}</div>
              </div>
              <div class="bg-gray-50 rounded-lg p-3 text-center">
                <div class="text-xs text-gray-500 mb-1">6ê°œì›”</div>
                <div class="text-lg font-bold ${f(mom['6m'] || 0).c}">${f(mom['6m'] || 0).t}</div>
              </div>
              <div class="bg-gray-50 rounded-lg p-3 text-center">
                <div class="text-xs text-gray-500 mb-1">YTD</div>
                <div class="text-lg font-bold ${f(mom.ytd || 0).c}">${f(mom.ytd || 0).t}</div>
              </div>
            </div>
            <div class="border-t pt-4">
              <h4 class="text-sm font-medium mb-2">ì—°ë„ë³„ ìˆ˜ìµë¥ </h4>
              <div class="grid grid-cols-4 gap-2">
                ${YEARS.map(y => {
                  const val = returns[y];
                  if (val === undefined) return '';
                  const ff = f(val);
                  return `
                    <div class="text-center p-2 bg-gray-50 rounded">
                      <div class="text-xs text-gray-500">${y}</div>
                      <div class="font-medium ${ff.c}">${ff.t}</div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          </div>
        `;
        $('detail-modal').classList.remove('hidden');
      };

      window.M = {
        closeM: () => $('detail-modal').classList.add('hidden'),
        closeK: () => $('shortcuts-modal').classList.add('hidden'),
        shareClose: () => $('share-modal').classList.add('hidden'),
        shareShow: () => $('share-modal').classList.remove('hidden'),
        shareCopy: () => {
          navigator.clipboard.writeText(window.location.href);
          toast('ë§ë³µì‚¬ë¨', 'success');
        },
        shareTW: () => {
          const text = `Momentum Dashboard - ${currentGroup.toUpperCase()} indices performance`;
          window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`, '_blank');
        },
        showK: () => $('shortcuts-modal').classList.remove('hidden')
      };

      // Keyboard shortcuts
      document.addEventListener('keydown', e => {
        if (e.target.tagName === 'INPUT') return;
        switch (e.key.toLowerCase()) {
          case 'r': refresh(); break;
          case '/': e.preventDefault(); $('table-search').focus(); break;
          case 'd': toggleD(); break;
          case 'c': toggleCmp(); break;
          case '?': M.showK(); break;
          case 'escape': $$('.modal').forEach(m => m.classList.add('hidden')); closeQ(); break;
        }
      });

      // Initialize dark mode from storage
      if (storage.get('dark', false)) document.documentElement.classList.add('dark');

      // Update time every minute
      setInterval(updateRelativeTime, 60000);
    }

    // Start
    init();
  </script>
</body>
</html>
