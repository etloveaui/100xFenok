<!DOCTYPE html>
<html lang="ko">

<head>
  <!-- Google tag (gtag.js) - 호스트별 자동 선택 -->
  <script>
    (function() {
      const GA_IDS = {
        'etloveaui.github.io': 'G-X7MZFQZRBW',
        '100xfenok.pages.dev': 'G-BWHGXQPH2D'
      };
      const id = GA_IDS[location.hostname] || 'G-X7MZFQZRBW';
      const s = document.createElement('script');
      s.async = true;
      s.src = 'https://www.googletagmanager.com/gtag/js?id=' + id;
      document.head.appendChild(s);
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      window.gtag = gtag;
      gtag('js', new Date());
      gtag('config', id);
    })();
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FenoK Dashboard - Main</title>


  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&amp;family=Noto+Sans+KR:wght@500;700&amp;display=swap"
    rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FenoK · Investment Knowledge</title>
  <meta name="description" content="Investment knowledge and market tools.">
  <link rel="canonical" href="./main.html">
  <meta property="og:title" content="FenoK · Investment Knowledge">
  <meta property="og:type" content="website">
  <meta property="og:image" content="./favicon-96x96.png">
  <meta name="theme-color" content="#0ea5e9">
  <style>
    /* 기본 폰트 및 커스텀 스타일 설정 */
    * {
      font-family: 'Noto Sans KR', sans-serif
    }

    .orbitron {
      font-family: 'Orbitron', monospace
    }

    .card-hover {
      transition: all .3s cubic-bezier(.4, 0, .2, 1)
    }

    .card-hover:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 25px -5px rgb(0 0 0 / .10), 0 8px 10px -6px rgb(0 0 0 / .10)
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .animate-fadeIn {
      animation: fadeIn 0.5s ease-in-out;
    }

    /* Macro Monitor 카드 최소 높이 통일 */
    .macro-card {
      min-height: 280px;
    }

    /* ===== Widget Carousel ===== */
    .carousel-container {
      position: relative;
      height: 280px;
      border-radius: 16px;
      overflow: hidden;
    }

    .carousel-slot {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: none;
      transition: opacity 0.7s ease-in-out;
    }

    .carousel-slot.active { opacity: 1; z-index: 10; }
    .carousel-slot.next { opacity: 0; z-index: 0; }

    .carousel-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 2px;
      background: linear-gradient(90deg, #3b82f6, #8b5cf6);
      width: 0%;
      z-index: 20;
      transition: none;
    }

    .carousel-progress.running {
      width: 100%;
      transition: width 5s linear;
    }

    /* ===== 모바일 반응형 (2025-12-13) ===== */
    @media (max-width: 767px) {
      .carousel-container {
        height: 320px;
      }
    }

    @media (max-width: 400px) {
      .carousel-container {
        height: 360px;
      }
    }

    /* ===== Hero Zone (Phase 1) ===== */
    .hero-zone {
      display: grid;
      grid-template-columns: 1fr 1fr 1.5fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    @media (max-width: 1024px) { .hero-zone { grid-template-columns: 1fr 1fr; } }
    @media (max-width: 768px) { .hero-zone { grid-template-columns: 1fr; } }

    .bento-card {
      background: white;
      border-radius: 1.25rem;
      border: 1px solid #e2e8f0;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
      padding: 1.25rem;
      transition: all 0.3s;
    }
    .bento-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }

    .regime-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.5rem 1rem;
      border-radius: 9999px;
      font-weight: 700;
      font-size: 0.875rem;
      color: white;
    }
    .regime-growth { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
    .regime-neutral { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
    .regime-defensive { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); }
    .regime-risk-off { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    .regime-unknown { background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%); }

    .market-state-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.625rem;
      border-radius: 9999px;
      font-size: 0.6875rem;
      font-weight: 600;
    }
    .state-regular { background: #dcfce7; color: #166534; }
    .state-pre { background: #fef9c3; color: #854d0e; }
    .state-post { background: #e0e7ff; color: #3730a3; }
    .state-closed { background: #f1f5f9; color: #64748b; }

    .index-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 0;
    }
    .index-row + .index-row { border-top: 1px solid #f1f5f9; }

    .change-up { color: #16a34a; }
    .change-down { color: #dc2626; }
    .change-flat { color: #64748b; }

    @keyframes shimmer {
      0% { background-position: -200px 0; }
      100% { background-position: calc(200px + 100%) 0; }
    }
    .skeleton {
      background: linear-gradient(90deg, #f1f5f9 0%, #e2e8f0 50%, #f1f5f9 100%);
      background-size: 200px 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 0.5rem;
    }
    .skeleton-text { height: 1rem; margin-bottom: 0.5rem; }
    .skeleton-badge { height: 2rem; width: 8rem; border-radius: 9999px; }
    .skeleton-number { height: 1.5rem; width: 6rem; }

    .sector-snapshot {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
      padding: 0.75rem 1rem;
      background: white;
      border-radius: 1rem;
      border: 1px solid #e2e8f0;
      margin-bottom: 1.5rem;
    }
    .sector-chip {
      padding: 0.25rem 0.625rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .sector-up { background: #dcfce7; color: #166534; }
    .sector-down { background: #fee2e2; color: #991b1b; }
    .sector-label {
      font-size: 0.6875rem;
      font-weight: 700;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .sector-divider {
      width: 1px;
      height: 1.25rem;
      background: #e2e8f0;
    }
  </style>
</head>

<body class="bg-slate-50 text-slate-800 animate-fadeIn text-base sm:text-lg lg:text-xl">
  <script type="module" src="./initBaseHref.js"></script>
  <main class="container mx-auto p-4 sm:p-6 md:py-20 lg:p-10">

    <!-- 헤드라인 (축소 버전) -->
    <header class="text-center mb-12">
      <h1
        class="text-3xl sm:text-4xl md:text-5xl font-black orbitron bg-clip-text text-transparent bg-gradient-to-r from-slate-900 to-blue-600">
        Investment Knowledge
      </h1>
      <p class="text-sm sm:text-base md:text-lg text-slate-500 max-w-2xl mx-auto mt-2">
        데이터 기반의 정교한 분석과 실전 검증된 투자 도구를 제공합니다.
      </p>

      <!-- 
      “What’s New”:
      A compact update panel listing the 3–5 most recent features, posts, or tools.
      Click any item to instantly open the relevant page.
      Shows the latest changes for quick access on the main page.
      -->
      <div class="flex flex-col items-center gap-2 my-4">

        <!-- 100x Market Radar -->
        <a href="index.html?path=tools/macro-monitor/index.html"
          class="transition hover:scale-105 duration-150 bg-gradient-to-r from-indigo-100 to-purple-50 border border-indigo-300 text-indigo-900 rounded-xl px-4 py-2 text-sm shadow-sm flex items-center gap-2 font-medium hover:bg-indigo-200 active:scale-100 w-full sm:w-[350px]"
          title="100x Market Radar - 거시경제 지표 통합 대시보드">
          <i class="fas fa-satellite-dish text-indigo-500"></i>
          <span>
            <strong>What's New:</strong> 100x Market Radar
          </span>
          <i class="fas fa-arrow-right ml-2 text-indigo-400"></i>
        </a>

      </div>

    </header>

    <!-- Hero Zone: Live Market Data (Phase 1) -->
    <section id="hero-zone" class="hero-zone">
      <!-- Card 1: Market Regime -->
      <div class="bento-card" id="card-regime">
        <div class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-3">Market Regime</div>
        <div id="regime-badge" class="regime-badge regime-unknown">
          <div class="skeleton skeleton-badge"></div>
        </div>
        <div class="mt-3 text-xs text-slate-400" id="regime-description">Loading...</div>
      </div>

      <!-- Card 2: VIX -->
      <div class="bento-card" id="card-vix">
        <div class="flex items-center justify-between mb-2">
          <div class="text-xs font-semibold text-slate-400 uppercase tracking-wider">VIX</div>
          <div id="market-state-badge" class="market-state-badge state-closed">
            <span class="inline-block w-1.5 h-1.5 rounded-full bg-current"></span>
            <span>--</span>
          </div>
        </div>
        <div id="vix-price" class="text-2xl font-bold orbitron text-slate-800">
          <div class="skeleton skeleton-number"></div>
        </div>
        <div id="vix-change" class="text-sm font-semibold mt-1 change-flat">--</div>
      </div>

      <!-- Card 3: Major Indices -->
      <div class="bento-card" id="card-indices">
        <div class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-3">Major Indices</div>
        <div id="indices-list">
          <div class="index-row"><div class="skeleton skeleton-text" style="width:100%"></div></div>
          <div class="index-row"><div class="skeleton skeleton-text" style="width:100%"></div></div>
          <div class="index-row"><div class="skeleton skeleton-text" style="width:100%"></div></div>
        </div>
      </div>
    </section>

    <!-- Sector Snapshot -->
    <div id="sector-snapshot" class="sector-snapshot" style="display:none;">
      <span class="sector-label">Sectors</span>
      <span class="sector-divider"></span>
      <span id="sector-chips"></span>
    </div>

    <!-- Macro Monitor Carousel Banner -->
    <section class="flex flex-col items-center mb-8">
      <!-- 2-Slot Carousel 컨테이너 -->
      <div id="carousel" class="carousel-container w-full max-w-[600px] lg:max-w-[500px] shadow-lg">
        <iframe id="slot-a" class="carousel-slot active" scrolling="no"></iframe>
        <iframe id="slot-b" class="carousel-slot next" scrolling="no"></iframe>
        <div id="carousel-progress" class="carousel-progress"></div>
      </div>

      <!-- CTA 버튼들: Market Radar + IB Helper -->
      <div class="mt-4 flex flex-col sm:flex-row items-center gap-3">
        <a href="index.html?path=tools/macro-monitor/index.html"
          class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-semibold rounded-full shadow-md hover:shadow-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-200">
          <span>100x Market Radar</span>
          <span class="text-xs bg-white/20 px-2 py-0.5 rounded-full">Live</span>
          <i class="fas fa-arrow-right"></i>
        </a>
        <a href="admin/ib-helper/index.html"
          class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-rose-500 to-amber-500 text-white font-semibold rounded-full shadow-md hover:shadow-lg hover:from-rose-600 hover:to-amber-600 transition-all duration-200">
          <i class="fas fa-calculator"></i>
          <span>100x IB Helper</span>
          <span class="text-xs bg-white/20 px-2 py-0.5 rounded-full">Beta</span>
        </a>
      </div>
    </section>

    <section class="grid gap-8 grid-cols-1 md:grid-cols-2 lg:grid-cols-3 mb-8">

      <!-- Market Wrap -->
      <a href="index.html?path=100x/100x-main.html"
        class="bg-white rounded-2xl p-6 sm:p-8 card-hover shadow-lg flex flex-col group">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl sm:text-2xl font-bold orbitron text-slate-900">100x Market Wrap</h2>
          <i class="fas fa-newspaper text-3xl text-blue-500 group-hover:text-blue-600"></i>
        </div>
        <p class="text-slate-500 mb-6">AI 기반 멀티에셋 분석으로 시장 핵심 동인을 심층 제공.</p>
        <div class="mt-auto border-t border-slate-200 pt-4 space-y-2 text-sm sm:text-base">
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>월스트리트 이슈 요약</p>
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>기관 자금 흐름</p>
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>실행 가능한 트레이드</p>
        </div>
      </a>
	  
	  <!-- Alpha Scout -->
      <a href="index.html?path=alpha-scout/alpha-scout-main.html"
        class="bg-white rounded-2xl p-6 sm:p-8 card-hover shadow-lg flex flex-col group">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl sm:text-2xl font-bold orbitron text-slate-900">100x Alpha Scout</h2>
          <i class="fas fa-compass text-3xl text-black-500 group-hover:text-rose-600"></i>
        </div>
        <p class="text-slate-500 mb-6">숨겨진 투자 기회를 발견하여 '알파'를 찾는 것을 목표.</p>
        <div class="mt-auto border-t border-slate-200 pt-4 space-y-2 text-sm sm:text-base">
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>전략별 종목 선별(Value & Momentum)</p>
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>기관 의견과 핵심 이벤트 일정</p>
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>투자 힌트 포착</p>
        </div>
      </a>

      <!-- 멀티 차트 (요청: 이름 변경 및 상단 배치) -->
      <a href="index.html?path=tools/asset/multichart.html"
        class="bg-white rounded-2xl p-6 sm:p-8 card-hover shadow-lg flex flex-col group">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl sm:text-2xl font-bold orbitron text-slate-900">100x Multichart Pro</h2>
          <i class="fas fa-chart-line text-3xl text-amber-500 group-hover:text-amber-600"></i>
        </div>
        <p class="text-slate-500 mb-6">레버리지 ETF까지 지원하는 초고속 브라우저 기반 멀티차트.</p>
        <div class="mt-auto border-t border-slate-200 pt-4 space-y-2 text-sm sm:text-base">
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>Stooq + Polygon 자동 소스
            선택</p>
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>100+ 종목 동시 분석</p>
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>성능 최적화 캐싱</p>
        </div>
      </a>

      <!-- 무한매수법 -->
      <a href="index.html?path=ib/ib-total-guide-calculator.html"
        class="bg-white rounded-2xl p-6 sm:p-8 card-hover shadow-lg flex flex-col group">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl sm:text-2xl font-bold orbitron text-slate-900">Infinite Buying</h2>
          <i class="fas fa-calculator text-3xl text-purple-500 group-hover:text-purple-600"></i>
        </div>
        <p class="text-slate-500 mb-6">TQQQ·SOXL 분할매수를 자동 계산해 주는 가이드.</p>
        <div class="mt-auto border-t border-slate-200 pt-4 space-y-2 text-sm sm:text-base">
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>실시간 가격 연동</p>
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>자동 주문표 생성</p>
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>위기관리 단계별 지원</p>
        </div>
      </a>

      <!-- 밸류리밸런싱 (요청: 이름 'VR' -> '밸류리밸런싱' 변경) -->
      <a href="index.html?path=vr/vr-main.html"
        class="bg-white rounded-2xl p-6 sm:p-8 card-hover shadow-lg flex flex-col group">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl sm:text-2xl font-bold orbitron text-slate-900">Value Rebalancing</h2>
          <i class="fas fa-balance-scale-right text-3xl text-teal-500 group-hover:text-teal-600"></i>
        </div>
        <p class="text-slate-500 mb-6">밸류 리밸런싱 완전 자동화 시스템과 백테스트.</p>
        <div class="mt-auto border-t border-slate-200 pt-4 space-y-2 text-sm">
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>VR 5.0 공식 계산기</p>
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>3단계 라이프사이클</p>
          <p class="flex items-center"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>성과 시뮬레이션</p>
        </div>
      </a>

      <!-- Quantum Analysis (요청: '분석' 탭 추가 및 이름 변경) -->
      <a href="index.html?path=posts/posts-main.html"
        class="bg-white rounded-2xl p-6 sm:p-8 card-hover shadow-lg flex flex-col group">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl sm:text-2xl font-bold text-slate-900 orbitron">Quantum Analysis</h2>
          <i class="fas fa-search-dollar text-3xl text-red-500 group-hover:text-red-600 transition-colors"></i>
        </div>
        <p class="text-slate-500 mb-6">시장의 거시적 흐름을 꿰뚫는 통찰력 높은 심층 분석 콘텐츠.</p>
        <div class="mt-auto border-t border-slate-200 pt-4 text-sm sm:text-base space-y-2">
          <p class="flex items-center text-slate-600"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>거시 경제 및
            정책 분석</p>
          <p class="flex items-center text-slate-600"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>미국 경제
            플레이북</p>
          <p class="flex items-center text-slate-600"><i class="fas fa-check-circle w-5 mr-2 text-green-500"></i>디지털 자산
            동향</p>
        </div>
      </a>

    </section>
  </main>

  <script>
    // ===== Hero Zone DataService (Phase 1) =====
    const MARKET_DATA_URL = 'https://script.google.com/macros/s/AKfycbwu2wdFAGAKnZlsb7w7BHsZzVS7wxHHRoYsKNTBg3Jc4kLOLv8TVuTeOSOC_gUo_BRS/exec';

    const DataService = {
      fetchAll() {
        return new Promise((resolve, reject) => {
          const cbName = '_mktCb_' + Date.now();
          const timeout = setTimeout(() => {
            delete window[cbName];
            if (s.parentNode) s.parentNode.removeChild(s);
            reject(new Error('Timeout'));
          }, 10000);

          window[cbName] = (data) => {
            clearTimeout(timeout);
            delete window[cbName];
            if (s.parentNode) s.parentNode.removeChild(s);
            resolve(data);
          };

          const s = document.createElement('script');
          s.src = `${MARKET_DATA_URL}?callback=${cbName}`;
          s.onerror = () => {
            clearTimeout(timeout);
            delete window[cbName];
            reject(new Error('Network error'));
          };
          document.head.appendChild(s);
        });
      },

      renderIndices(indices) {
        const el = document.getElementById('indices-list');
        if (!indices) return;
        const order = ['^GSPC', '^IXIC', '^DJI'];
        el.innerHTML = order.map(sym => {
          const d = indices[sym];
          if (!d) return '';
          const cls = d.changePercent > 0 ? 'change-up' : d.changePercent < 0 ? 'change-down' : 'change-flat';
          const arr = d.changePercent > 0 ? '▲' : d.changePercent < 0 ? '▼' : '–';
          return `<div class="index-row">
            <div class="text-sm font-bold text-slate-800">${d.name}</div>
            <div class="text-right">
              <div class="text-sm font-bold orbitron text-slate-800">${d.price.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2})}</div>
              <div class="text-xs font-semibold ${cls}">${arr} ${Math.abs(d.changePercent).toFixed(2)}%</div>
            </div>
          </div>`;
        }).join('');
      },

      renderVIX(vix) {
        if (!vix) return;
        const cls = vix.changePercent > 0 ? 'change-up' : vix.changePercent < 0 ? 'change-down' : 'change-flat';
        const arr = vix.changePercent > 0 ? '▲' : vix.changePercent < 0 ? '▼' : '–';
        document.getElementById('vix-price').textContent = vix.price.toFixed(2);
        const changeEl = document.getElementById('vix-change');
        changeEl.className = `text-sm font-semibold mt-1 ${cls}`;
        changeEl.textContent = `${arr} ${vix.change > 0 ? '+' : ''}${vix.change.toFixed(2)} (${Math.abs(vix.changePercent).toFixed(2)}%)`;
      },

      renderRegime(vix) {
        if (!vix || !vix.regime) return;
        const badge = document.getElementById('regime-badge');
        const desc = document.getElementById('regime-description');
        const r = vix.regime;
        const cMap = { green: 'growth', blue: 'neutral', orange: 'defensive', red: 'risk-off', gray: 'unknown' };
        const dMap = {
          Growth: 'VIX < 20 — Risk-on environment',
          Neutral: 'VIX 20-25 — Balanced conditions',
          Defensive: 'VIX 25-30 — Elevated caution',
          'Risk-Off': 'VIX > 30 — High volatility alert'
        };
        badge.className = `regime-badge regime-${cMap[r.color] || 'unknown'}`;
        badge.innerHTML = `<i class="fas fa-signal"></i> ${r.label}`;
        desc.textContent = dMap[r.label] || `VIX: ${vix.price}`;
      },

      renderMarketState(state) {
        const badge = document.getElementById('market-state-badge');
        if (!badge) return;
        const map = {
          REGULAR: { cls: 'state-regular', lbl: 'LIVE' },
          PRE:     { cls: 'state-pre',     lbl: 'PRE-MKT' },
          POST:    { cls: 'state-post',    lbl: 'AFTER-HRS' },
          CLOSED:  { cls: 'state-closed',  lbl: 'CLOSED' }
        };
        const s = map[state] || map.CLOSED;
        badge.className = `market-state-badge ${s.cls}`;
        badge.innerHTML = `<span class="inline-block w-1.5 h-1.5 rounded-full bg-current"></span><span>${s.lbl}</span>`;
      },

      renderSectors(sectors) {
        if (!sectors) return;
        const el = document.getElementById('sector-snapshot');
        const chips = document.getElementById('sector-chips');
        const sorted = Object.entries(sectors)
          .map(([sym, d]) => ({ sym, ...d }))
          .sort((a, b) => b.changePercent - a.changePercent);
        const top3 = sorted.slice(0, 3);
        const bot3 = sorted.slice(-3).reverse();
        chips.innerHTML = [
          ...top3.map(s => `<span class="sector-chip sector-up">${s.sym} +${s.changePercent.toFixed(2)}%</span>`),
          '<span class="sector-divider"></span>',
          ...bot3.map(s => `<span class="sector-chip sector-down">${s.sym} ${s.changePercent.toFixed(2)}%</span>`)
        ].join('');
        el.style.display = 'flex';
      },

      showError() {
        document.getElementById('regime-badge').innerHTML = '<i class="fas fa-exclamation-triangle"></i> Unavailable';
        document.getElementById('regime-badge').className = 'regime-badge regime-unknown';
        document.getElementById('regime-description').textContent = 'Could not load market data';
        document.getElementById('vix-price').textContent = '--';
        document.getElementById('vix-change').textContent = 'Data unavailable';
        document.getElementById('indices-list').innerHTML = '<div class="text-sm text-slate-400 py-4 text-center">Market data unavailable</div>';
      },

      async init() {
        try {
          const data = await this.fetchAll();
          this.renderIndices(data.indices);
          this.renderVIX(data.vix);
          this.renderRegime(data.vix);
          this.renderMarketState(data.marketState);
          this.renderSectors(data.sectors);
        } catch (err) {
          console.error('[HeroZone] Fetch error:', err);
          this.showError();
        }
      }
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => DataService.init());
    } else {
      DataService.init();
    }
  </script>

  <script>
    // SPA 네비게이션
    document.body.addEventListener('click', event => {
      const link = event.target.closest('a[href*="?path="]');
      if (!link) return;
      event.preventDefault();
      parent.loadPage(new URL(link.href).searchParams.get('path'));
    });

    // ===== Smart 2-Slot Carousel =====
    (function() {
      const WIDGETS = ['liquidity-stress', 'liquidity-flow', 'banking-health', 'sentiment-signal'];
      const INTERVAL = 5000;      // 5초
      const READY_TIMEOUT = 2000; // 2초 Safety

      let currentIndex = 0;       // 현재 표시 중인 위젯
      let activeSlot = 'a';       // 현재 활성 슬롯
      let isPaused = false;
      let timer = null;
      let readyTimeout = null;
      let pendingWidgetId = null; // 전환 대기 중인 위젯 ID

      const slotA = document.getElementById('slot-a');
      const slotB = document.getElementById('slot-b');
      const progress = document.getElementById('carousel-progress');
      const carousel = document.getElementById('carousel');

      function getWidgetUrl(index) {
        return `./tools/macro-monitor/widgets/${WIDGETS[index]}.html`;
      }

      function requestDataForWidget(widgetId) {
        if (window.parent === window) return;
        window.parent.postMessage({ type: 'REQUEST_WIDGET_DATA', widgetId }, '*');
        console.log(`[Carousel] ${widgetId} 데이터 요청`);
      }

      function resetProgress() {
        progress.classList.remove('running');
        progress.style.width = '0%';
        void progress.offsetWidth; // Force reflow
      }

      function startProgress() {
        if (isPaused) return;
        resetProgress();
        requestAnimationFrame(() => {
          progress.classList.add('running');
        });
      }

      function executeTransition(toIndex) {
        clearTimeout(readyTimeout);
        pendingWidgetId = null;

        // 슬롯 교체
        if (activeSlot === 'a') {
          slotA.classList.remove('active');
          slotA.classList.add('next');
          slotB.classList.remove('next');
          slotB.classList.add('active');
          activeSlot = 'b';
        } else {
          slotB.classList.remove('active');
          slotB.classList.add('next');
          slotA.classList.remove('next');
          slotA.classList.add('active');
          activeSlot = 'a';
        }

        currentIndex = toIndex;
        console.log(`[Carousel] 전환 완료 → ${WIDGETS[currentIndex]} (index: ${currentIndex})`);

        startProgress();
        scheduleNext();
      }

      function prepareNextWidget() {
        const nextIndex = (currentIndex + 1) % WIDGETS.length;
        const nextSlot = activeSlot === 'a' ? slotB : slotA;
        const nextWidgetId = WIDGETS[nextIndex];

        // 로드 시작 시 null로 초기화 (캐시된 위젯의 WIDGET_READY 무시)
        pendingWidgetId = null;

        nextSlot.onload = () => {
          // onload 후에만 대기 위젯 설정
          pendingWidgetId = nextWidgetId;
          console.log(`[Carousel] ${nextWidgetId} 로드 완료, 데이터 요청`);
          requestDataForWidget(nextWidgetId);

          // Safety Timeout
          readyTimeout = setTimeout(() => {
            console.warn(`[Carousel] READY 타임아웃 (${nextWidgetId}), 강제 전환`);
            executeTransition(nextIndex);
          }, READY_TIMEOUT);
        };

        nextSlot.src = getWidgetUrl(nextIndex);
        console.log(`[Carousel] ${nextWidgetId} 로드 시작 (nextIndex: ${nextIndex})`);
      }

      function scheduleNext() {
        clearTimeout(timer);
        if (isPaused) return;

        timer = setTimeout(() => {
          prepareNextWidget();
        }, INTERVAL);
      }

      function pause() {
        isPaused = true;
        clearTimeout(timer);
        clearTimeout(readyTimeout);
        progress.style.transition = 'none';
        console.log('[Carousel] 일시정지');
      }

      function resume() {
        isPaused = false;
        startProgress();
        scheduleNext();
        console.log('[Carousel] 재개');
      }

      // 메시지 핸들러
      window.addEventListener('message', (event) => {
        const { type, widgetId, payload } = event.data || {};

        // index.html로부터 데이터 응답
        if (type === 'WIDGET_DATA_RESPONSE') {
          console.log(`[Carousel] ${widgetId} 데이터 수신`);
          // 양쪽 슬롯 모두에서 해당 위젯 찾기
          [slotA, slotB].forEach(slot => {
            if (slot.src && slot.src.includes(`${widgetId}.html`) && slot.contentWindow) {
              slot.contentWindow.postMessage({ type: 'WIDGET_DATA_UPDATE', payload }, '*');
            }
          });
        }

        // 위젯 렌더링 완료 신호
        if (type === 'WIDGET_READY') {
          const readyWidgetId = event.data.widgetId;

          // 대기 위젯 없으면 무시
          if (!pendingWidgetId) {
            console.log(`[Carousel] WIDGET_READY 무시 (${readyWidgetId}): 대기 위젯 없음`);
            return;
          }

          // 대기 중인 위젯과 일치하는지 확인
          if (readyWidgetId !== pendingWidgetId) {
            console.log(`[Carousel] WIDGET_READY 무시: ${readyWidgetId} (대기: ${pendingWidgetId})`);
            return;
          }

          const nextIndex = WIDGETS.indexOf(pendingWidgetId);
          console.log(`[Carousel] WIDGET_READY 수신 → ${pendingWidgetId} 전환 실행`);
          executeTransition(nextIndex);
        }
      });

      // 호버 이벤트
      carousel.addEventListener('mouseenter', pause);
      carousel.addEventListener('mouseleave', resume);

      // 초기화
      function init() {
        console.log('[Carousel] 초기화 시작');
        slotA.src = getWidgetUrl(0);
        slotA.onload = () => {
          console.log(`[Carousel] 첫 위젯 ${WIDGETS[0]} 로드 완료`);
          requestDataForWidget(WIDGETS[0]);
          startProgress();
          scheduleNext();
        };
      }

      if (document.readyState === 'complete') {
        init();
      } else {
        window.addEventListener('load', init);
      }
    })();
  </script>
</body>

</html>