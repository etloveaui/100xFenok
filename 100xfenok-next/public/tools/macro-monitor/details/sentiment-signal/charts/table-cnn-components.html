<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CNN Fear & Greed Components | Market Radar</title>
  <meta name="robots" content="noindex, nofollow">
  <link rel="icon" type="image/x-icon" href="../../../favicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #ffffff;
    }
    .orbitron { font-family: 'Orbitron', monospace; }
    .indicator-bar {
      height: 8px;
      border-radius: 4px;
      background: linear-gradient(to right,
        #ef4444 0%, #ef4444 25%,
        #f97316 25%, #f97316 40%,
        #eab308 40%, #eab308 60%,
        #22c55e 60%, #22c55e 75%,
        #16a34a 75%, #16a34a 100%
      );
    }
    .indicator-marker {
      width: 4px;
      height: 16px;
      background: #1f2937;
      border-radius: 2px;
      position: absolute;
      top: -4px;
      transform: translateX(-50%);
    }
    .change-up { color: #22c55e; }
    .change-down { color: #ef4444; }
    .change-neutral { color: #9ca3af; }
  </style>
</head>
<body class="p-4 sm:p-6">

  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-xl font-bold text-gray-800 flex items-center gap-2">
      <span class="text-2xl">ğŸ“‹</span>
      CNN Fear & Greed Components
    </h1>
    <p class="text-sm text-gray-500 mt-1">7 Indicators Breakdown (Today vs Yesterday)</p>
  </div>

  <!-- Summary Card -->
  <div class="flex flex-wrap items-center gap-6 mb-6 p-4 bg-gray-50 rounded-xl">
    <div>
      <div class="text-xs text-gray-500 mb-1">Latest Date</div>
      <div id="latestDate" class="text-lg font-bold text-gray-800">--</div>
    </div>
    <div>
      <div class="text-xs text-gray-500 mb-1">Previous Date</div>
      <div id="prevDate" class="text-lg font-medium text-gray-600">--</div>
    </div>
    <div class="ml-auto text-right">
      <div class="text-xs text-gray-500 mb-1">Overall Change</div>
      <div id="overallChange" class="text-lg font-bold">--</div>
    </div>
  </div>

  <!-- Components Table -->
  <div class="bg-white rounded-2xl border border-gray-200 overflow-hidden">
    <table class="w-full">
      <thead class="bg-gray-50 border-b border-gray-200">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Indicator</th>
          <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider w-24">Today</th>
          <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider w-24">Yesterday</th>
          <th class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider w-20">Change</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider min-w-[200px]">Level</th>
        </tr>
      </thead>
      <tbody id="componentsTable" class="divide-y divide-gray-100">
        <!-- Dynamic content -->
      </tbody>
    </table>
  </div>

  <!-- Legend -->
  <div class="mt-6 flex flex-wrap gap-4 text-xs text-gray-600">
    <div class="flex items-center gap-2">
      <div class="w-4 h-3 bg-red-500 rounded"></div>
      <span>Extreme Fear (0-25)</span>
    </div>
    <div class="flex items-center gap-2">
      <div class="w-4 h-3 bg-orange-500 rounded"></div>
      <span>Fear (25-40)</span>
    </div>
    <div class="flex items-center gap-2">
      <div class="w-4 h-3 bg-yellow-500 rounded"></div>
      <span>Neutral (40-60)</span>
    </div>
    <div class="flex items-center gap-2">
      <div class="w-4 h-3 bg-green-500 rounded"></div>
      <span>Greed (60-75)</span>
    </div>
    <div class="flex items-center gap-2">
      <div class="w-4 h-3 bg-green-700 rounded"></div>
      <span>Extreme Greed (75-100)</span>
    </div>
  </div>

  <!-- Info Note -->
  <div class="mt-4 p-4 bg-blue-50 rounded-xl text-sm text-blue-800">
    <i class="fas fa-info-circle mr-2"></i>
    <strong>Note:</strong> CNN Fear & Greed IndexëŠ” 7ê°œ ì§€í‘œì˜ ê°€ì¤‘ í‰ê· ì…ë‹ˆë‹¤. ê°œë³„ ì§€í‘œì˜ ì›€ì§ì„ì´ ì „ì²´ ì§€ìˆ˜ì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  </div>

  <script>
    // Component names and icons
    const COMPONENTS = {
      market_momentum: { name: 'Market Momentum', icon: 'ğŸ“Š', description: 'S&P 500 vs 125-day MA' },
      stock_strength: { name: 'Stock Price Strength', icon: 'ğŸ’ª', description: '52-week highs vs lows' },
      stock_breadth: { name: 'Stock Price Breadth', icon: 'ğŸ“ˆ', description: 'Advance/Decline volume' },
      put_call: { name: 'Put/Call Ratio', icon: 'ğŸ“‰', description: 'Options trading sentiment' },
      volatility: { name: 'Market Volatility', icon: 'âš¡', description: 'VIX 50-day MA comparison' },
      safe_haven: { name: 'Safe Haven Demand', icon: 'ğŸ›¡ï¸', description: 'Bonds vs stocks return' },
      junk_bond: { name: 'Junk Bond Demand', icon: 'ğŸ’°', description: 'HY bond spread' }
    };

    // Get color class based on value
    function getValueColor(value) {
      if (value >= 75) return 'text-green-700 font-bold';
      if (value >= 60) return 'text-green-600';
      if (value >= 40) return 'text-yellow-600';
      if (value >= 25) return 'text-orange-600';
      return 'text-red-600 font-bold';
    }

    // Get status text
    function getStatus(value) {
      if (value >= 75) return 'Extreme Greed';
      if (value >= 60) return 'Greed';
      if (value >= 40) return 'Neutral';
      if (value >= 25) return 'Fear';
      return 'Extreme Fear';
    }

    // Get change indicator
    function getChangeHtml(change) {
      if (change > 0) {
        return `<span class="change-up"><i class="fas fa-arrow-up mr-1"></i>+${change.toFixed(1)}</span>`;
      } else if (change < 0) {
        return `<span class="change-down"><i class="fas fa-arrow-down mr-1"></i>${change.toFixed(1)}</span>`;
      }
      return `<span class="change-neutral"><i class="fas fa-minus mr-1"></i>0</span>`;
    }

    // Render table row
    function renderRow(key, today, yesterday) {
      const component = COMPONENTS[key];
      const change = today - yesterday;

      return `
        <tr class="hover:bg-gray-50 transition-colors">
          <td class="px-4 py-4">
            <div class="flex items-center gap-3">
              <span class="text-xl">${component.icon}</span>
              <div>
                <div class="font-medium text-gray-800">${component.name}</div>
                <div class="text-xs text-gray-500">${component.description}</div>
              </div>
            </div>
          </td>
          <td class="px-4 py-4 text-center">
            <span class="text-lg ${getValueColor(today)}">${today.toFixed(1)}</span>
          </td>
          <td class="px-4 py-4 text-center text-gray-600">
            ${yesterday.toFixed(1)}
          </td>
          <td class="px-4 py-4 text-center">
            ${getChangeHtml(change)}
          </td>
          <td class="px-4 py-4">
            <div class="relative">
              <div class="indicator-bar"></div>
              <div class="indicator-marker" style="left: ${today}%"></div>
            </div>
            <div class="text-xs text-gray-500 mt-1">${getStatus(today)}</div>
          </td>
        </tr>
      `;
    }

    // Calculate average change
    function calculateAvgChange(today, yesterday) {
      const keys = Object.keys(COMPONENTS);
      let totalChange = 0;
      let count = 0;

      keys.forEach(key => {
        if (today[key] !== undefined && yesterday[key] !== undefined) {
          totalChange += today[key] - yesterday[key];
          count++;
        }
      });

      return count > 0 ? totalChange / count : 0;
    }

    // Fetch and render
    async function init() {
      try {
        const response = await fetch('../../../../../data/sentiment/cnn-components.json');
        const data = await response.json();

        // Sort by date descending
        data.sort((a, b) => new Date(b.date) - new Date(a.date));

        if (data.length < 2) {
          document.getElementById('componentsTable').innerHTML = `
            <tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">
              ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ìµœì†Œ 2ì¼ì˜ ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤.
            </td></tr>
          `;
          return;
        }

        const today = data[0];
        const yesterday = data[1];

        // Update dates
        document.getElementById('latestDate').textContent = today.date;
        document.getElementById('prevDate').textContent = yesterday.date;

        // Calculate overall change
        const avgChange = calculateAvgChange(today, yesterday);
        const overallEl = document.getElementById('overallChange');
        if (avgChange > 0) {
          overallEl.innerHTML = `<span class="change-up"><i class="fas fa-arrow-up mr-1"></i>+${avgChange.toFixed(1)}</span>`;
        } else if (avgChange < 0) {
          overallEl.innerHTML = `<span class="change-down"><i class="fas fa-arrow-down mr-1"></i>${avgChange.toFixed(1)}</span>`;
        } else {
          overallEl.innerHTML = `<span class="change-neutral">No Change</span>`;
        }

        // Render table rows
        const tableHtml = Object.keys(COMPONENTS).map(key =>
          renderRow(key, today[key], yesterday[key])
        ).join('');

        document.getElementById('componentsTable').innerHTML = tableHtml;

      } catch (error) {
        console.error('Failed to fetch CNN components:', error);
        document.getElementById('componentsTable').innerHTML = `
          <tr><td colspan="5" class="px-4 py-8 text-center text-red-500">
            <i class="fas fa-exclamation-triangle mr-2"></i>
            ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
          </td></tr>
        `;
      }
    }

    init();
  </script>

</body>
</html>
