<nav class="enhanced-nav container mx-auto px-4 sm:px-6 py-3">
  <div class="flex justify-between items-center">
    <a href="index.html?path=main.html" data-path="main.html"
      class="logo-section flex items-center space-x-3 text-2xl group">
      <img src="./favicon.svg" alt="100x FenoK Icon"
        class="h-12 w-12 transition-transform duration-300 group-hover:rotate-[-10deg]">
      <span class="brand-text">100x FenoK</span>
    </a>

    <div class="nav-links hidden md:flex items-center space-x-8">
      <a href="index.html?path=ib/ib-total-guide-calculator.html" data-path="ib/ib-total-guide-calculator.html"
        class="nav-item">ë¬´í•œë§¤ìˆ˜ë²•</a>
      <a href="index.html?path=vr/vr-main.html" data-path="vr/vr-main.html" class="nav-item">VR</a>
      <a href="index.html?path=tools/asset/multichart.html" data-path="tools/asset/multichart.html"
        class="nav-item">ë©€í‹°ì°¨íŠ¸</a>
      <a href="index.html?path=100x/100x-main.html" data-path="100x/100x-main.html" class="nav-item">Daily Wrap</a>
      <a href="index.html?path=posts/posts-main.html" data-path="posts/posts-main.html" class="nav-item">ë¶„ì„</a>
    </div>
  </div>
</nav>

<div class="combined-floating-menu lg:hidden">
  <button class="main-toggle-btn" id="main-toggle">
    <i class="fas fa-dot-circle"></i>
  </button>

  <div class="sub-buttons" id="sub-buttons">
    <a href="index.html?path=main.html" data-path="main.html" class="sub-btn home-sub">
      <i class="fas fa-redo"></i> <!-- ë¡œì¼“ (ì„±ì¥/íˆ¬ì) -->
    </a>

    <button class="sub-btn scroll-sub" id="scroll-combined">
      <i class="fas fa-rocket"></i> <!-- ë ˆë²¨ì—… í™”ì‚´í‘œ -->
    </button>
  </div>

  <!-- ìƒˆë¡œìš´ ì™¼ìª½ ê³µìœ  ë²„íŠ¼ -->
  <div class="share-button" id="share-button">
    <button class="sub-btn share-sub" id="share-url">
      <i class="fas fa-share-alt"></i>
    </button>
  </div>


</div>

<script>
  (function () {
    function initFloatingMenu() {
      const mainToggle = document.getElementById('main-toggle');
      const subButtons = document.getElementById('sub-buttons');
      const scrollBtn = document.getElementById('scroll-combined');
      const shareBtn = document.getElementById('share-url'); // ê³µìœ  ë²„íŠ¼ ì¶”ê°€

      if (!mainToggle || !subButtons) {
        setTimeout(initFloatingMenu, 500);
        return;
      }

      let isOpen = false;

      // ë©”ì¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ)
      mainToggle.addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation();

        isOpen = !isOpen;

        if (isOpen) {
          mainToggle.classList.add('active');
          subButtons.classList.add('active');
        } else {
          mainToggle.classList.remove('active');
          subButtons.classList.remove('active');
        }
      });

      // ê³µìœ  ë²„íŠ¼ ê¸°ëŠ¥ (ìµœì¢… ì™„ë²½ ë²„ì „)
      if (shareBtn) {
        shareBtn.addEventListener('click', function (e) {
          e.preventDefault();
          e.stopPropagation();

          console.log('ğŸ”— URL ë³µì‚¬ ì‹œì‘');

          // loadPage.jsì—ì„œ ì„¤ì •í•œ ì „ì—­ ë³€ìˆ˜ í™œìš©
          let currentPath = 'main.html';

          try {
            // ë°©ë²• 1: windowì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê¸°
            if (window.currentActivePage) {
              currentPath = window.currentActivePage;
              console.log('âœ… ì „ì—­ ë³€ìˆ˜ì—ì„œ í˜„ì¬ ê²½ë¡œ íšë“:', currentPath);
            } else if (window.parent && window.parent.currentActivePage) {
              // ë°©ë²• 2: ë¶€ëª¨ ì°½ì—ì„œ ê°€ì ¸ì˜¤ê¸° (iframe í™˜ê²½)
              currentPath = window.parent.currentActivePage;
              console.log('âœ… ë¶€ëª¨ ì°½ì—ì„œ í˜„ì¬ ê²½ë¡œ íšë“:', currentPath);
            } else {
              // ë°©ë²• 3: URL paramsì—ì„œ fallback
              const urlParams = new URLSearchParams(window.location.search);
              currentPath = urlParams.get('path') || 'main.html';
              console.log('ğŸ“ URL params fallback ì‚¬ìš©:', currentPath);
            }
          } catch (error) {
            console.log('âŒ ê²½ë¡œ íšë“ ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©:', error);
            currentPath = 'main.html';
          }

          // ì™„ì „í•œ ê³µìœ  URL êµ¬ì„±
          const baseURL = window.location.origin + window.location.pathname;
          const shareableURL = `${baseURL}?path=${currentPath}`;

          console.log('ğŸ“‹ ê³µìœ í•  ì™„ì „í•œ URL:', shareableURL);

          // í´ë¦½ë³´ë“œì— URL ë³µì‚¬
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(shareableURL)
              .then(() => {
                console.log('âœ… URL ë³µì‚¬ ì™„ë£Œ:', shareableURL);
                showCopyNotification('URLì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
              })
              .catch((error) => {
                console.log('âŒ URL ë³µì‚¬ ì‹¤íŒ¨:', error);
                fallbackCopyURL(shareableURL);
              });
          } else {
            fallbackCopyURL(shareableURL);
          }

          // ë©”ë‰´ ë‹«ê¸°
          isOpen = false;
          mainToggle.classList.remove('active');
          subButtons.classList.remove('active');
        });
      }


      // ìœ„ë¡œê°€ê¸° ê¸°ëŠ¥ - ì˜¬ë°”ë¥¸ ìŠ¤í¬ë¡¤ ëŒ€ìƒ ì§€ì •
      if (scrollBtn) {
        scrollBtn.addEventListener('click', function (e) {
          e.preventDefault();
          e.stopPropagation();

          console.log('ğŸš€ ìœ„ë¡œê°€ê¸° ì‹œì‘');

          // ë°©ë²• 1: iframe ë‚´ë¶€ ìŠ¤í¬ë¡¤ (í˜„ì¬ í˜ì´ì§€ê°€ iframeì¸ ê²½ìš°)
          const iframe = document.querySelector('iframe');
          if (iframe && iframe.contentWindow) {
            try {
              iframe.contentWindow.scrollTo({ top: 0, behavior: 'smooth' });
              console.log('âœ… iframe ë‚´ë¶€ ìŠ¤í¬ë¡¤ ì„±ê³µ');
            } catch (error) {
              console.log('iframe ë‚´ë¶€ ìŠ¤í¬ë¡¤ ì‹¤íŒ¨:', error);
            }
          }

          // ë°©ë²• 2: ë¶€ëª¨ window ìŠ¤í¬ë¡¤ (ê°€ì¥ ì¤‘ìš”!)
          try {
            if (window.parent && window.parent !== window) {
              window.parent.scrollTo({ top: 0, behavior: 'smooth' });
              console.log('âœ… ë¶€ëª¨ ì°½ ìŠ¤í¬ë¡¤ ì„±ê³µ');
            }
          } catch (error) {
            console.log('ë¶€ëª¨ ì°½ ìŠ¤í¬ë¡¤ ì‹¤íŒ¨:', error);
          }

          // ë°©ë²• 3: index.htmlì˜ iframe ì°¾ì•„ì„œ ìŠ¤í¬ë¡¤
          try {
            const parentDocument = window.parent.document;
            const contentFrame = parentDocument.getElementById('content-frame');
            if (contentFrame && contentFrame.contentWindow) {
              contentFrame.contentWindow.scrollTo({ top: 0, behavior: 'smooth' });
              console.log('âœ… content-frame ìŠ¤í¬ë¡¤ ì„±ê³µ');
            }
          } catch (error) {
            console.log('content-frame ìŠ¤í¬ë¡¤ ì‹¤íŒ¨:', error);
          }

          // ë°©ë²• 4: ëª¨ë“  ê°€ëŠ¥í•œ ìŠ¤í¬ë¡¤ ìš”ì†Œ ì‹œë„
          try {
            // í˜„ì¬ ì°½
            window.scrollTo({ top: 0, behavior: 'smooth' });
            document.documentElement.scrollTop = 0;
            document.body.scrollTop = 0;

            // ë¶€ëª¨ ì°½ì˜ ëª¨ë“  ìŠ¤í¬ë¡¤ ìš”ì†Œ
            if (window.parent && window.parent.document) {
              window.parent.document.documentElement.scrollTop = 0;
              window.parent.document.body.scrollTop = 0;
            }

            console.log('âœ… ì „ì²´ ìŠ¤í¬ë¡¤ ì‹œë„ ì™„ë£Œ');
          } catch (error) {
            console.log('ì „ì²´ ìŠ¤í¬ë¡¤ ì‹œë„ ì‹¤íŒ¨:', error);
          }

          // ë©”ë‰´ ë‹«ê¸°
          isOpen = false;
          mainToggle.classList.remove('active');
          subButtons.classList.remove('active');
        });
      }
    }

    // URL ë³µì‚¬ ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
    function showCopyNotification(message) {
      // ê¸°ì¡´ ì•Œë¦¼ ì œê±°
      const existingNotification = document.querySelector('.copy-notification');
      if (existingNotification) {
        existingNotification.remove();
      }

      // ìƒˆ ì•Œë¦¼ ìƒì„±
      const notification = document.createElement('div');
      notification.className = 'copy-notification';
      notification.textContent = message;
      notification.style.cssText = `
      position: fixed;
      bottom: 80px;
      right: 20px;
      background: rgba(34, 197, 94, 0.9);
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1001;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s ease;
    `;

      document.body.appendChild(notification);

      // ì• ë‹ˆë©”ì´ì…˜
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateY(0)';
      }, 10);

      // 3ì´ˆ í›„ ì œê±°
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-10px)';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // êµ¬í˜• ë¸Œë¼ìš°ì €ìš© URL ë³µì‚¬ í•¨ìˆ˜
    function fallbackCopyURL(url) {
      const textArea = document.createElement('textarea');
      textArea.value = url;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      textArea.style.top = '-999999px';
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();

      try {
        document.execCommand('copy');
        console.log('âœ… fallback URL ë³µì‚¬ ì„±ê³µ');
        showCopyNotification('URLì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
      } catch (error) {
        console.log('âŒ fallback URL ë³µì‚¬ ì‹¤íŒ¨:', error);
        showCopyNotification('URL ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }

      document.body.removeChild(textArea);
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initFloatingMenu);
    } else {
      initFloatingMenu();
    }
  })();
</script>